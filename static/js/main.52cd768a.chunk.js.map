{"version":3,"sources":["Sidebar.js","Projection.js","About.js","Content.js","Layout.js","Data.js","AppContext.js","App.js","serviceWorker.js","index.js"],"names":["Sidebar","_Component","_classCallCheck","this","_possibleConstructorReturn","_getPrototypeOf","apply","arguments","_inherits","_createClass","key","value","props","setSidebarCanvas","side_canvas","handleSelectAlgorithm","bind","handleSelectModel","handleSelectDataset","e","v","target","selectAlgorithm","selectModel","selectDataset","_this","_this$props","sidebar_orientation","sidebar_image_size","grem","p","hover_index","color_array","mnist_labels","model_options","model_choice","dataset_options","dataset_choice","img_labels","algorithm_options","algorithm_choice","React","createElement","style","display","flexDirection","justifyContent","flexGrow","padding","alignItems","width","onChange","map","option","index","ref","height","background","concat","Math","round","random","join","color","transition","id","overflowY","float","onClick","toggleAbout","Component","pointInPolygon","require","mnist_tile_locations","_toConsumableArray","Array","n","i","process","mnist_images","src","img","document","Projection","call","handleResize","camera","aspect","updateProjectionMatrix","renderer","setSize","current_scale","getScaleFromZ","position","z","d3_x","x","d3_y","y","resize_transform","d3","translate","scale","view","mount","d3_zoom","transform","state","init","_assertThisInitialized","addPoints","setUpCamera","animate","getZFromScale","changeEmbeddings","input","scaleMin","scaleMax","domain","range","clamp","scaleProj","message","parameters","undefined","fontface","hasOwnProperty","fontsize","borderThickness","borderColor","r","g","b","a","backgroundColor","textColor","canvas","context","getContext","clearRect","font","textWidth","measureText","beginPath","rect","stroke","fillStyle","strokeStyle","fill","fillText","texture","THREE","needsUpdate","spriteMaterial","useScreenCoordinates","prev_choice","new_choice","_this2","console","log","model_embedding_keys","ranges","start","sprite_side","end","sprite_number","push","embedding_chunks","slice","_loop","echunk","c","points","scene","children","numVertices","length","geometry","attributes","array","Float32Array","l","tween","TWEEN","to","easing","Quadratic","InOut","onUpdate","new_txt_embeddings","txt_points","vertices","vertex","Linear","None","rvFOV","degToRad","fov","tan","camera_z_position","fov_height","d3_transform","k","set","new_size","zoomScaler","point_group","material","uniforms","size","camera_z_start","img_embeddings","vFOV","xs","min_x","_","max_x","ys","min_y","max_y","max_x_from_center","m","abs","max_y_from_center","far","max","scaleExtent","on","zoomHandler","initial_scale","initial_transform","_this$props2","mnist_embeddings","label_chunks","loader","textures","t","load","flipY","magFilter","embedding","vert","positions","offsets","cluster","filtered","addAttribute","floor","repeat","sprite_image_size","greyTransparency","imageTransparency","clusterActive","vertexShader","fragmentShader","transparent","point_cloud","userData","sprite_index","add","pointsMaterial","_this$props3","txt_embeddings","pointsGeometry","colors","_step","_iterator","_createForOfIteratorHelper","s","done","point","text","setHSL","err","f","opacity","sizeAttenuation","vertexColors","pointsContainer","edges","line","_step2","_this$props4","_iterator2","_this3","_this$props5","fetch","then","response","json","raw_points","_step3","_iterator3","coords","_this$props6","txt","mesh","light","_this$props7","spritey","makeTextSprite","hover_container","offset","frustumCulled","visible","digit_index","full_index","_this$props8","copyVector3sArray","highlight_container","highlights","remove","mouse_position","_this$props9","sidebar_ctx","sortIntersectsByDistanceToRay","intersects","mouse_vector","_ref","_ref2","_slicedToArray","mouseX","mouseY","mouseToThree","raycaster","setFromCamera","params","Points","threshold","intersectObjects","intersect","object","setHoverIndex","highlightPoint","fillRect","drawImage","intersects_text","selectedObject","getObjectByName","name","getElementById","innerHTML","_this4","domElement","shiftKey","_d3$mouse","node","_d3$mouse2","checkIntersects","_this5","_this$props10","_ref3","_ref4","mouseToCoords","_ref5","_ref6","selectionPoints","addEventListener","lasso","clientX","clientY","checkinside","buttons","setFromPoints","polygon","pointsinside","reduce","_this$props11","setClearColor","appendChild","addBlankHighlightPoints","handleMouse","addTextPoints","requestAnimationFrame","render","prevProps","_this$props12","removeChild","_this6","_this$props13","overflow","About","left","top","right","bottom","paddingTop","fontSize","lineHeight","className","textAlign","cursor","textDecoration","maxWidth","margin","Markdown","tb","lr","Layout","ww","wh","sidebar_height","show_about","checkHash","indexOf","setState","window","innerWidth","innerHeight","sidebar_mount","offsetHeight","imageSmoothingEnabled","ctx","history","pushState","location","pathname","hash","removeEventListener","val","clip_img_embeddings","clip_txt_embeddings","algorithm_embedding_keys","_this$state","sidebar_style","main_style","font_size","_objectSpread","scaler","general_style","handleChangeScale","createContext","Data","md08_umap_mnist_embeddings","embeddings","scaled_embeddings","scaleEmbeddings","Object","assign","App","Boolean","hostname","match","ReactDOM","navigator","serviceWorker","ready","registration","unregister"],"mappings":"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","file":"static/js/main.52cd768a.chunk.js","sourcesContent":["import React, { Component } from 'react'\n\nclass Sidebar extends Component {\n  componentDidMount() {\n    this.props.setSidebarCanvas(this.side_canvas)\n    this.handleSelectAlgorithm = this.handleSelectAlgorithm.bind(this)\n    this.handleSelectModel = this.handleSelectModel.bind(this)\n    this.handleSelectDataset = this.handleSelectDataset.bind(this)\n\n  }\n\n  handleSelectAlgorithm(e) {\n    let v = e.target.value\n    this.props.selectAlgorithm(v)\n  }\n\n  handleSelectModel(e) {\n    let v = e.target.value\n    this.props.selectModel(v)\n  }\n  handleSelectDataset(e) {\n    let v = e.target.value\n    this.props.selectDataset(v)\n  }\n\n  render() {\n    let {\n      sidebar_orientation,\n      sidebar_image_size,\n      grem,\n      p,\n      hover_index,\n      mnist_labels,\n      color_array,\n      model_options,\n      model_choice,\n      dataset_options,\n      dataset_choice,\n      algorithm_options,\n      algorithm_choice,\n      img_labels\n    } = this.props\n\n    return (\n      <div\n        style={{\n          display: 'flex',\n          flexDirection: 'column',\n          justifyContent: 'space-between',\n          flexGrow: 1,\n        }}\n      >\n        <div>\n          {' '}\n          <div\n            style={{\n              padding: grem / 2,\n              display: 'flex',\n              justifyContent: 'space-between',\n              alignItems: 'center',\n            }}\n          >\n            <div>Emebedding Model:</div>\n            <select\n              style={{width:100}}\n              onChange={this.handleSelectModel}\n              value={model_options[model_choice]}\n            >\n              {model_options.map((option, index) => (\n                <option key={option} value={option}>\n                  {option}\n                </option>\n              ))}\n            </select>\n          </div>\n\n\n          <div\n            style={{\n              padding: grem / 2,\n              display: 'flex',\n              justifyContent: 'space-between',\n              alignItems: 'center',\n            }}\n          >\n            <div>Dataset:</div>\n            <select\n              style={{width:100}}\n              onChange={this.handleSelectDataset}\n              value={dataset_options[dataset_choice]}\n            >\n              {dataset_options.map((option, index) => (\n                <option key={option} value={option}>\n                  {option}\n                </option>\n              ))}\n            </select>\n          </div>\n\n\n          <div\n            style={{\n              display: 'flex',\n              flexDirection:\n                sidebar_orientation === 'horizontal' ? 'row' : 'column',\n            }}\n          >\n            <div>\n\n              <canvas\n                ref={side_canvas => {\n                  this.side_canvas = side_canvas\n                }}\n                width={sidebar_image_size}\n                height={sidebar_image_size}\n              />\n            </div>\n            \n            <div style={{ flexGrow: 1 }}>\n              <div\n                style={{\n                  background: hover_index\n                    //? `rgb(${color_array[mnist_labels[hover_index]].join(',')})`\n                    ? `rgb(${color_array[Math.round(Math.random()*10)].join(',')})`\n                    : 'transparent',\n                  color: hover_index ? '#000' : '#fff',\n                  padding: p(grem / 4, grem / 2),\n                  display: 'flex',\n                  justifyContent: 'space-between',\n                  transition: 'all 0.1s linear',\n                }}\n              >\n                <div>Label:</div>\n        \n                {hover_index ? <div>{img_labels[hover_index]}</div> : null}\n              </div>\n              <div\n                style={{\n                  padding: p(grem / 4, grem / 2),\n                  display: 'flex',\n                  justifyContent: 'space-between',\n                }}\n              >\n                Image Index:\n                {hover_index ? <div>{hover_index}</div> : null}\n              </div>\n              <hr></hr>\n\n              <div id=\"text\" style={{\n              padding: p(grem / 4, grem / 2),\n              display: 'flex',\n              justifyContent: 'space-between',\n              overflowY: 'scroll',\n              float: 'left',\n              height:'200px',\n            }}></div>\n            </div>\n            <div\n            style={{\n              padding: p(grem / 4, grem / 2),\n             \n              justifyContent: 'space-between',\n            }}\n            >\n              <br /> <br /><br /> <br />\n              <b>Scroll up/down to zoom in/out, hover for more info on datapoints<br /> <br />\n              Image and Text are jointly embedded and visualized using UMAP\n              <br /> <br />\n              Label and index will be used if additional metadata is included.\n              </b></div>\n\n          </div>\n          \n        </div>\n        <div style={{ padding: grem / 2 }}>\n          <div>\n            A WIP Multimodal embedding viewer.{' '}\n            <button\n              onClick={() => {\n                this.props.toggleAbout(true)\n              }}\n            >\n              About\n            </button>\n          </div>\n        </div>\n      </div>\n    )\n  }\n}\n\nexport default Sidebar\n","import React, { Component } from 'react'\nimport * as THREE from 'three'\nimport * as _ from 'lodash'\nimport * as d3 from 'd3'\nimport * as TWEEN from '@tweenjs/tween.js'\nvar pointInPolygon = require('point-in-polygon');\n//var polygon = [ [ 1, 1 ], [ 1, 2 ], [ 2, 2 ], [ 2, 1 ] ];\n\n//console.log(pointInPolygon([ 1.5, 1.5 ], polygon)); // true\n//console.log(pointInPolygon([ 4.9, 1.2 ], polygon)); // false\n//console.log(pointInPolygon([ 1.8, 1.1 ], polygon)); // true\n\n// Constants for sprite sheets - original\n/*let sprite_side = 73\nlet sprite_size = sprite_side * sprite_side\nlet sprite_number = 14\nlet sprite_image_size = 28\n// actual sprite size needs to be power of 2\nlet sprite_actual_size = 2048\n\nlet mnist_tile_string = 'mnist_tile_solid_'\nlet mnist_tile_locations = [...Array(sprite_number)].map(\n  (n, i) => `${process.env.PUBLIC_URL}/${mnist_tile_string}${i}.png`\n)\n\nlet mnist_images = mnist_tile_locations.map(src => {\n  let img = document.createElement('img')\n  img.src = src\n  return img\n})*/\n/////////////////\n\nlet sprite_side = 16\nlet sprite_size = sprite_side * sprite_side\nlet sprite_number = 1//8 1\nlet sprite_image_size = 4096/16\n// actual sprite size needs to be power of 2\nlet sprite_actual_size = 4096\n\n//let mnist_tile_string = 'wiki_tile_'\nlet mnist_tile_string = 'highres_tile_'\n\nlet mnist_tile_locations = [...Array(sprite_number)].map(\n  (n, i) => `${process.env.PUBLIC_URL}/sprites/${mnist_tile_string}${i}.png`\n)\n\nlet mnist_images = mnist_tile_locations.map(src => {\n  let img = document.createElement('img')\n  img.src = src\n  return img\n})\n\nlet zoomScaler_old = input => {\n  let scale1 = d3\n    .scaleLinear()\n    .domain([20, 5])\n    .range([50, 500])\n    .clamp(true)\n  let scale2 = d3\n    .scaleLinear()\n    .domain([2, 0.1])\n    .range([500, 5000])\n  if (input >= 5) {\n    return scale1(input)\n    // return 28\n  } else if (input <= 2) {\n     return scale2(input)\n    //return 28\n  } else {\n    return 28\n  }\n}\n\n\n\n    \nclass Projection extends Component {\n  constructor(props) {\n    super(props)\n    this.state = {}\n    this.init = this.init.bind(this)\n    this.addPoints = this.addPoints.bind(this)\n    this.handleResize = this.handleResize.bind(this)\n    this.setUpCamera = this.setUpCamera.bind(this)\n    this.animate = this.animate.bind(this)\n    this.getScaleFromZ = this.getScaleFromZ.bind(this)\n    this.getZFromScale = this.getZFromScale.bind(this)\n    this.changeEmbeddings = this.changeEmbeddings.bind(this)\n  }\n\n\n  zoomScaler(input,scaleMin,scaleMax ) {\n    let scaleProj = d3\n    .scaleLinear()\n    .domain([20,0])\n    .range([scaleMin, scaleMax])\n    .clamp(true);\n    return scaleProj(input);\n  }\n  \n\n  \n  \n\n    makeTextSprite( message, parameters )\n\n    {\n        if ( parameters === undefined ) parameters = {};\n        var fontface = parameters.hasOwnProperty(\"fontface\") ? parameters[\"fontface\"] : \"Cambria\";\n        var fontsize = parameters.hasOwnProperty(\"fontsize\") ? parameters[\"fontsize\"] : 18;\n        var borderThickness = parameters.hasOwnProperty(\"borderThickness\") ? parameters[\"borderThickness\"] : 4;\n        var borderColor = parameters.hasOwnProperty(\"borderColor\") ?parameters[\"borderColor\"] : { r:0, g:0, b:0, a:1.0 };\n        var backgroundColor = parameters.hasOwnProperty(\"backgroundColor\") ?parameters[\"backgroundColor\"] : { r:255, g:0, b:255, a:1.0 };\n        var textColor = parameters.hasOwnProperty(\"textColor\") ?parameters[\"textColor\"] : { r:0, g:0, b:0, a:1.0 };\n        var pad = 5\n        var canvas = document.createElement('canvas');\n        var context = canvas.getContext('2d');\n        //context.scale(this.getScaleFromZ(this.camera.position.z),this.getScaleFromZ(this.camera.position.z));\n        context.clearRect(0, 0, canvas.width, canvas.height);\n\n        context.font = fontsize + \"px \" + fontface;\n        \n        var metrics = context.measureText( message );\n        var textWidth = metrics.width;\n        //context.canvas.width=metrics.width\n        context.beginPath();\n        context.rect(0, fontsize/2 -pad, borderThickness+textWidth +2*pad, fontsize + borderThickness+2*pad);\n        context.stroke();\n        context.fillStyle   = \"rgba(\" + backgroundColor.r + \",\" + backgroundColor.g + \",\" + backgroundColor.b + \",\" + backgroundColor.a + \")\";\n        context.strokeStyle = \"rgba(\" + borderColor.r + \",\" + borderColor.g + \",\" + borderColor.b + \",\" + borderColor.a + \")\";\n        context.fill()\n        context.stroke()\n        context.fillStyle = \"rgba(\"+textColor.r+\", \"+textColor.g+\", \"+textColor.b+\", 1.0)\";\n        context.fillText( message, borderThickness, fontsize + borderThickness,textWidth);\n\n        var texture = new THREE.Texture(canvas) \n        texture.needsUpdate = true;\n        var spriteMaterial = new THREE.SpriteMaterial( { map: texture, useScreenCoordinates: false } );\n        var sprite = new THREE.Sprite( spriteMaterial );\n        //sprite.scale.set(1 * fontsize, 0.05 * fontsize, 0.75 * fontsize);\n        return sprite;  \n    }\n  changeEmbeddings(prev_choice, new_choice) {\n\n\n    // assumes mnist embeddings has been updated\n    console.log(this.props.model_embedding_keys[new_choice]+'img_embeddings')\n\n    let ranges = []\n    for (let i = 0; i < sprite_number; i++) {\n      let start = i * sprite_size\n      let end = (i + 1) * sprite_size\n      if (i === sprite_number - 1) end = sprite_number * sprite_size\n      ranges.push([start, end])\n    }\n\n    let embedding_chunks = ranges.map(range =>\n      this.props[this.props.model_embedding_keys[new_choice]+'img_embeddings'].slice(\n        range[0],\n        range[1]\n      )\n    )\n\n    for (let c = 0; c < sprite_number; c++) {\n      let echunk = embedding_chunks[c]\n\n      let points = this.scene.children[0].children[c]\n      let numVertices = echunk.length\n      let position = points.geometry.attributes.position.array\n\n      let target = new Float32Array(numVertices * 3)\n      for (let i = 0, index = 0, l = numVertices; i < l; i++, index += 3) {\n        let x = echunk[i][0]\n        let y = echunk[i][1]\n        let z = 0\n        target[index] = x\n        target[index + 1] = y\n        target[index + 2] = z\n      }\n\n\n      let tween = new TWEEN.Tween(position)\n        .to(position, 1000)\n        .easing(TWEEN.Easing.Quadratic.InOut)\n      tween.onUpdate(function() {\n        points.geometry.attributes.position = new THREE.BufferAttribute(\n          position,\n          3\n        )\n\n        \n        points.geometry.attributes.position.needsUpdate = true // required after the first render\n      })\n      tween.start()\n    }\n  \n    let new_txt_embeddings = this.props[this.props.model_embedding_keys[new_choice]+'txt_embeddings']\n    let txt_points = this.scene.children[2].children[0]\n    let numVertices = new_txt_embeddings.length\n    let position = txt_points.geometry.vertices\n    let target = new Float32Array(numVertices * 3)\n    let vertices = []\n\n    for (let i = 0, index = 0; i < new_txt_embeddings.length; i++, index += 3) {\n      target[index] = new_txt_embeddings[i][0]\n      target[index + 1] = new_txt_embeddings[i][1]\n      target[index + 2] = 0.5\n      const vertex = new THREE.Vector3(new_txt_embeddings[i][0], new_txt_embeddings[i][1], 0.5);\n      vertices.push(vertex)\n\n    }\n\n    console.log(position,vertices)\n    let tween = new TWEEN.Tween(position)\n    .to(vertices, 1000)\n    .easing(TWEEN.Easing.Linear.None)\n  tween.onUpdate(function() {\n    txt_points.geometry.vertices = vertices\n    txt_points.geometry.position.needsUpdate = true // required after the first render\n    txt_points.geometry.vertices.needsUpdate = true\n  })\n  tween.start()\n\n  \n  \n  }\n\n  getZFromScale(scale) {\n    let rvFOV = THREE.Math.degToRad(this.camera.fov)\n    let scale_height = this.props.height / scale\n    let camera_z_position = scale_height / (2 * Math.tan(rvFOV / 2))\n    return camera_z_position\n  }\n\n  getScaleFromZ(camera_z_position) {\n    let rvFOV = THREE.Math.degToRad(this.camera.fov)\n    let half_fov_height = Math.tan(rvFOV / 2) * camera_z_position\n    let fov_height = half_fov_height * 2\n    let scale = this.props.height / fov_height\n    return scale\n  }\n\n  \n  handleResize = (width, height) => {\n    this.camera.aspect = width / height\n    this.camera.updateProjectionMatrix()\n    this.renderer.setSize(width, height)\n    let current_scale = this.getScaleFromZ(this.camera.position.z)\n    let d3_x = -(this.camera.position.x * current_scale) + this.props.width / 2\n    let d3_y = this.camera.position.y * current_scale + this.props.height / 2\n    var resize_transform = d3.zoomIdentity\n      .translate(d3_x, d3_y)\n      .scale(current_scale)\n    let view = d3.select(this.mount)\n    this.d3_zoom.transform(view, resize_transform)\n\n  }\n\n  zoomHandler() {\n    let d3_transform = d3.event.transform\n\n    let scale = d3_transform.k\n    let x = -(d3_transform.x - this.props.width / 2) / scale\n    let y = (d3_transform.y - this.props.height / 2) / scale\n    let z = this.getZFromScale(scale)\n    this.camera.position.set(x, y, z)\n\n    // point size scales at end of zoom\n    let new_size = this.zoomScaler(z, 35,500)\n    let point_group = this.scene.children[0].children\n    for (let c = 0; c < point_group.length; c++) {\n      point_group[c].material.uniforms.size.value = new_size\n    }\n  }\n\n  setUpCamera() {\n    let { width, height, img_embeddings } = this.props\n\n    let aspect = this.camera.aspect\n    let vFOV = this.camera.fov\n    let rvFOV = THREE.Math.degToRad(vFOV)\n\n    let xs = img_embeddings.map(e => e[0])\n    let min_x = _.min(xs)\n    let max_x = _.max(xs)\n    let ys = img_embeddings.map(e => e[1])\n    let min_y = _.min(ys)\n    let max_y = _.max(ys)\n    let data_width = max_x - min_x\n    let data_center_x =  (max_x + min_x)/2\n    let data_height = max_y - min_y\n    let data_center_y =  (max_y + min_y)/2\n    let data_aspect = data_width / data_height\n\n    let max_x_from_center = _.max([min_x, max_x].map(m => Math.abs(m)))\n    let max_y_from_center = _.max([min_y, max_y].map(m => Math.abs(m)))\n\n    let max_center = Math.max(max_x_from_center, max_y_from_center)\n\n    let camera_z_start\n    if (data_aspect > aspect) {\n      //console.log(\"width is limiter\");\n      // camera_z_start = max_x_from_center / Math.tan(rvFOV / 2) / aspect\n    } else {\n       //console.log(\"height is limiter\");\n       //camera_z_start = max_y_from_center / Math.tan(rvFOV / 2)\n    }\n\n    camera_z_start = max_center / Math.tan(rvFOV / 2)\n\n    let far = camera_z_start \n    this.camera.far = far    \n    //this.camera.lookAt(new THREE.Vector3(-10 ,0,0)); // Set look at coordinate like this\n    \n    this.camera.position.set(0,0,camera_z_start*1.1); // Set position like this\n\n\n    // set up zoom\n    this.d3_zoom = d3\n      .zoom()\n      .scaleExtent([this.getScaleFromZ(far - 1), this.getScaleFromZ(0.1)])\n      .on('zoom', this.zoomHandler.bind(this))\n\n    let view = d3.select(this.mount)\n    this.view = view\n    view.call(this.d3_zoom)\n    let initial_scale = this.getScaleFromZ(this.camera.position.z)\n    var initial_transform = d3.zoomIdentity\n      .translate(width / 2, height / 2)\n      .scale(initial_scale)\n    this.d3_zoom.transform(view, initial_transform)\n  }\n\n  addPoints() {\n    let { mnist_embeddings,img_embeddings, mnist_labels, img_labels, color_array } = this.props\n\n    // split embeddings and labels into chunks to match sprites\n    let ranges = []\n    for (let i = 0; i < sprite_number; i++) {\n      let start = i * sprite_size\n      let end = (i + 1) * sprite_size\n      if (i === sprite_number - 1) end = sprite_number * sprite_size\n      ranges.push([start, end])\n    }\n\n    let embedding_chunks = ranges.map(range =>\n      img_embeddings.slice(range[0], range[1])\n    )\n    let label_chunks = ranges.map(range =>\n      mnist_labels.slice(range[0], range[1])\n    )\n\n    // load the textures\n    let loader = new THREE.TextureLoader()\n    this.textures = mnist_tile_locations.map(l => {\n      let t = loader.load(l)\n      t.flipY = false\n      t.magFilter = THREE.NearestFilter\n      // t.minFilter = THREE.LinearMipMapLinearFilter;\n      return t\n    })\n\n    let point_group = new THREE.Group()\n    for (let c = 0; c < sprite_number; c++) {\n      let echunk = embedding_chunks[c]\n      let lchunk = label_chunks[c]\n\n      let vertices = []\n      for (let v = 0; v < echunk.length; v++) {\n        let embedding = echunk[v]\n        let vert = new THREE.Vector3(embedding[0], embedding[1], 0)\n        vertices[v] = vert\n      }\n\n      let geometry = new THREE.BufferGeometry()\n\n      let numVertices = vertices.length\n      let positions = new Float32Array(numVertices * 3)\n      let offsets = new Float32Array(numVertices * 2)\n      let cluster = new Float32Array(numVertices * 3)\n      let filtered = new Float32Array(numVertices );\n      geometry.addAttribute('position', new THREE.BufferAttribute(positions, 3))\n      geometry.addAttribute('offset', new THREE.BufferAttribute(offsets, 2))\n      geometry.addAttribute('filter', new THREE.BufferAttribute(filtered, 1));\n      geometry.addAttribute('cluster', new THREE.BufferAttribute(cluster, 3));\n\n\n      for (let i = 0, index = 0, l = numVertices; i < l; i++, index += 3) {\n        let x = echunk[i][0]\n        let y = echunk[i][1]\n        let z = 0\n        positions[index] = x\n        positions[index + 1] = y\n        positions[index + 2] = z\n      }\n\n      // geometry.attributes.position.copyVector3sArray(vertices)\n\n      let texture_subsize = 1 / sprite_side\n\n      for (let i = 0, index = 0, l = numVertices; i < l; i++, index += 2) {\n        let x = ((i % sprite_side) * sprite_image_size) / sprite_actual_size\n        let y =\n          (Math.floor(i / sprite_side) * sprite_image_size) / sprite_actual_size\n        offsets[index] = x\n        offsets[index + 1] = y\n      }\n\n  \n        // Todo: connect cluster the array\n        //let clusterSelected = this.props.clusterTypeSelected;\n       // let clusterColors = this.props.settings.clusters.clusterColors;\n        // console.log(\"clusterSelected\",clusterSelected)\n        for (let i = 0, index = 0, l = numVertices; i < l; i++, index += 1) {\n          // Images disable when are not visible\n          filtered[index] = 0.0;// default value to show all images\n\n          // Clusters visualization\n          let clusterSelected = 1\n          let clusterColors = [1,2,3,1,2,3]\n          if( clusterSelected !== \"-\" ){ \n              let clusterId = 2;\n              if(clusterId >= clusterColors.length){\n                cluster[index*3] = 1.0;\n                cluster[index*3 + 1] = 1.0;\n                cluster[index*3 + 2] = 1.0;\n              }else{\n                cluster[index*3] = 0;\n                cluster[index*3 + 1] = 1;\n                cluster[index*3 + 2] = 0;\n              }\n          }\n      }\n    \n      // uniforms\n      let uniforms = {\n        texture: { value: this.textures[c] },\n        repeat: { value: new THREE.Vector2(texture_subsize, texture_subsize) },\n        size: { value: this.sprite_image_size },\n        greyTransparency:{ value:1},\n        imageTransparency:{ value:0},\n        clusterActive:{ value:0.0}\n      };\n\n      let vertex_shader = `\n        attribute vec2 offset;\n        varying vec2 vOffset;\n        attribute vec3 cluster;\n        varying vec3 vCluster;\n        attribute float filteredActive;\n        varying float vFilteredActive;\n        uniform float clusterActive;\n        varying float vClusterActive;\n        uniform float size;\n        uniform float greyTransparency;\n        varying float vGreyTransparency;\n        uniform float imageTransparency;\n        varying float vImageTransparency;\n\n        void main() {\n          vOffset = offset;\n          vFilteredActive = filteredActive;\n          vCluster = cluster;\n          vClusterActive = clusterActive;\n          vGreyTransparency = greyTransparency;\n          vImageTransparency = imageTransparency;\n          gl_PointSize = size;\n          gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n        }`;\n\n      let fragment_shader = `\n        uniform sampler2D texture;\n        uniform vec2 repeat;\n        varying vec2 vOffset;\n        varying vec3 vCluster;\n        varying float vClusterActive;\n        varying float vFilteredActive;\n        varying float vGreyTransparency;\n        varying float vImageTransparency;\n        void main() {\n          vec2 uv = vec2( gl_PointCoord.x, gl_PointCoord.y );\n          vec4 tex = texture2D( texture, uv * repeat + vOffset );\n          // make transparent images\n          if ( tex.a < 0.003 ) discard;\n\n          // Display clusters\n          vec4 replace_color = vec4(vCluster,1.0);\n          vec4 default_border_color = vec4(0.00392156863,0.00392156863,0.00392156863,0.0);\n          vec4 diff = tex - default_border_color;\n          float equality = float(dot(diff,diff) < 0.99 && vClusterActive > 0.9);\n          tex = mix( tex, replace_color, equality);\n           \n          // make transparent images\n          tex = mix( tex,  vec4(0.0,0.0,0.0,0.0), vImageTransparency);\n\n          // Grey images filter our selection \n          vec4 filterout_color = vec4(0.3,0.3,0.3,vGreyTransparency);\n          float filterout_equality = float(vFilteredActive > 0.9);\n          tex = mix( tex, filterout_color, filterout_equality );\n          gl_FragColor = tex; //* vec4(vColor, 1.0);\n        }`;\n      // material\n      let material = new THREE.ShaderMaterial({\n        uniforms: uniforms,\n        vertexShader: vertex_shader,\n        fragmentShader: fragment_shader,\n        transparent: true\n      });\n\n      // point cloud\n      let point_cloud = new THREE.Points(geometry, material)\n      point_cloud.userData = { sprite_index: c }\n\n      point_group.add(point_cloud)\n\n\n      \n    }\n\n    this.scene.add(point_group)\n\n\n\n  }\n\n\n  addTextPoints() {\n    let { txt_embeddings, mnist_labels, img_labels, color_array } = this.props\n    let pointsMaterial;\n    \n\n        const pointsGeometry = new THREE.Geometry();\n        const colors = [];\n        let numVertices = txt_embeddings.length\n        let positions = new Float32Array(numVertices * 3)\n\n        for (let i = 0, index = 0; i < txt_embeddings.length; i++, index += 3) {\n          positions[index] = txt_embeddings[i][0]\n          positions[index + 1] = txt_embeddings[i][1]\n          positions[index + 2] = 0.5\n        }\n\n        pointsGeometry.position = positions\n        for (const point of txt_embeddings) {\n          const vertex = new THREE.Vector3(point[0], point[1], 0.5);\n          vertex.userData = { text: \"heyyyy\" }\n          pointsGeometry.vertices.push(vertex);\n          const color = new THREE.Color();\n          color.setHSL(0., 0.65, 0.5);\n          colors.push(color);\n          \n        \n      }\n        pointsGeometry.colors = colors;\n        pointsMaterial = new THREE.PointsMaterial({\n          // map: spriteMap,\n          size: 4,\n          opacity: 0.9,\n           transparent: true,\n          // blending: THREE.AdditiveBlending,\n          sizeAttenuation: false,\n          vertexColors: THREE.VertexColors,\n        });\n        const points = new THREE.Points(pointsGeometry, pointsMaterial);\n        this.pointsContainer = new THREE.Object3D();\n        this.pointsContainer.add(points);\n        this.scene.add(this.pointsContainer);\n        const edges = new THREE.EdgesGeometry( pointsGeometry ); \n        const line = new THREE.LineSegments(edges, new THREE.LineBasicMaterial( { color: 0xffffff } ) ); \n        this.scene.add(line);\n      \n    }\n  \n  addImgPoints() {\n      let { img_embeddings, mnist_labels, img_labels, color_array } = this.props\n      let pointsMaterial;\n      \n  \n          const pointsGeometry = new THREE.Geometry();\n          const colors = [];\n  \n          for (const point of img_embeddings) {\n            const vertex = new THREE.Vector3(point[0], point[1], 0.5);\n            pointsGeometry.vertices.push(vertex);\n            const color = new THREE.Color();\n            color.setHSL(0.6, 1.0, 0.5);\n            colors.push(color);\n          \n        }\n          pointsGeometry.colors = colors;\n          pointsMaterial = new THREE.PointsMaterial({\n            // map: spriteMap,\n            size: 5,\n            // transparent: true,\n            // blending: THREE.AdditiveBlending,\n            sizeAttenuation: false,\n            vertexColors: THREE.VertexColors,\n          });\n          const points = new THREE.Points(pointsGeometry, pointsMaterial);\n          const pointsContainer = new THREE.Object3D();\n          pointsContainer.add(points);\n          this.scene.add(pointsContainer);\n        \n      }\n\n  addTextPointsold() {\n    let { mnist_embeddings,img_embeddings, mnist_labels, img_labels, color_array } = this.props\n    let pointsMaterial;\n\n    fetch('//fastforwardlabs.github.io/visualization_assets/word2vec_tsne_2d.json')\n      .then(response => response.json())\n      .then(raw_points => {\n        const pointsGeometry = new THREE.Geometry();\n        const colors = [];\n        for (const point of raw_points) {\n          const vertex = new THREE.Vector3(point.coords[0], point.coords[1], 0);\n          pointsGeometry.vertices.push(vertex);\n          const color = new THREE.Color();\n          color.setHSL(Math.random(), 1.0, 0.5);\n          colors.push(color);\n        }\n        pointsGeometry.colors = colors;\n        pointsMaterial = new THREE.PointsMaterial({\n          // map: spriteMap,\n          size: 2,\n          // transparent: true,\n          // blending: THREE.AdditiveBlending,\n          sizeAttenuation: false,\n          vertexColors: THREE.VertexColors,\n        });\n        const points = new THREE.Points(pointsGeometry, pointsMaterial);\n        const pointsContainer = new THREE.Object3D();\n        pointsContainer.add(points);\n        this.scene.add(pointsContainer);\n      });\n\n  }\n\n  addTextPoints2() {\n    let { txt_embeddings, mnist_labels, txt, color_array } = this.props\n\n      // Create a texture loader so we can load our image file\n      var loader = new THREE.TextureLoader();\n\n      // Load an image file into a custom material\n      var material = new THREE.MeshLambertMaterial({\n        //map: loader.load('https://s3.amazonaws.com/duhaime/blog/tsne-webgl/assets/cat.jpg')\n        map: loader.load('https://upload.wikimedia.org/wikipedia/commons/thumb/9/92/Location_dot_red.svg/1200px-Location_dot_red.svg.png')\n      });\n\n      // create a plane geometry for the image with a width of 10\n      // and a height that preserves the image's aspect ratio\n      var geometry = new THREE.PlaneGeometry(1, 1);\n\n      // combine our image geometry and material into a mesh\n      var mesh = new THREE.Mesh(geometry, material);\n\n      // set the position of the image mesh in the x,y,z dimensions\n      mesh.position.set(0,0,0)\n\n      // add the image to the scene\n      this.scene.add(mesh);\n\n      /**\n      * Lights\n      **/\n\n      // Add a point light with #fff color, .7 intensity, and 0 distance\n      var light = new THREE.PointLight( 0xffffff, 1, 0 );\n\n      // Specify the light's position\n      light.position.set(1, 1, 100 );\n\n      // Add the light to the scene\n      this.scene.add(light)\n\n  }\n\n\n\n  addtexts(){\n    let { txt, txt_embeddings } = this.props\n\n    for (let c = 0; c < txt_embeddings.length; c++){\n        var spritey = this.makeTextSprite( txt[c], \n\t\t{ fontsize: 18, textColor: {r:0, g:0, b:0, a:0.8}} );\n        spritey.position.set(txt_embeddings[c][0],txt_embeddings[c][1],0.5);\n        this.scene.add( spritey );\n    }\n\n  }\n\n\n  addBlankHighlightPoints() {\n    let hover_container = new THREE.Group();\n    this.scene.add(hover_container);\n\n    let vert = new THREE.Vector3(0, 0, 0);\n    let vertices = [vert];\n    let geometry = new THREE.BufferGeometry();\n    let numVertices = vertices.length;\n    var position = new Float32Array(numVertices * 3); // 3 coordinates per point\n    var offset = new Float32Array(numVertices * 2); // 2 coordinates per point\n    geometry.addAttribute('position', new THREE.BufferAttribute(position, 3));\n    geometry.addAttribute('offset', new THREE.BufferAttribute(offset, 2));\n\n    // all the attributes will be filled on hover\n    let texture_subsize = 1 / sprite_side;\n\n    // uniforms\n    let uniforms = {\n      texture: { value: this.textures[0] },\n      repeat: { value: new THREE.Vector2(texture_subsize, texture_subsize) },\n      size: { value: 200.0 }, //56\n    };\n\n    let vertex_shader = `\n        attribute vec2 offset;\n        varying vec2 vOffset;\n        uniform float size;\n        void main() {\n          vOffset = offset;\n          gl_PointSize = size;\n          gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n        }`;\n\n    let fragment_shader = `\n        uniform sampler2D texture;\n        uniform vec2 repeat;\n        varying vec2 vOffset;\n        void main() {\n          vec2 uv = vec2( gl_PointCoord.x, gl_PointCoord.y );\n          vec4 tex = texture2D( texture, uv * repeat + vOffset );\n          gl_FragColor = tex;\n        }`;\n\n    // material\n    var material = new THREE.ShaderMaterial({\n      uniforms: uniforms,\n      vertexShader: vertex_shader,\n      fragmentShader: fragment_shader,\n      transparent: true,\n    });\n\n    let point = new THREE.Points(geometry, material);\n    point.frustumCulled = false;\n\n    this.scene.children[1].visible = false;\n    this.scene.children[1].add(point);\n  }\n  highlightPoint(sprite_index, digit_index, full_index) {\n    let { model_embedding_keys, model_choice,img_embeddings } = this.props\n\n    let point = this.scene.children[1].children[0]\n\n    //let embedding = this.props[model_embedding_keys[model_choice]+'img_embeddings'][\n     // full_index\n    //]\n\n\n    let embedding = img_embeddings[\n      full_index\n    ]\n\n\n    let vert = new THREE.Vector3(embedding[0], embedding[1], 0)\n    let vertices = [vert]\n\n    var offsets = new Float32Array(2) // 2 coordinates per point\n\n    let x = ((digit_index % sprite_side) * sprite_image_size) / sprite_actual_size \n    let y = (Math.floor(digit_index / sprite_side) * sprite_image_size) / sprite_actual_size \n    offsets[0] = x\n    offsets[1] = y\n\n    point.geometry.attributes.position.copyVector3sArray(vertices)\n    point.geometry.attributes.position.needsUpdate = true // required after the first render\n    point.geometry.attributes.offset.array = offsets\n    point.geometry.attributes.offset.needsUpdate = true // required after the first render\n\n    // need to set attributes on geometry and uniforms on material\n    point.material.uniforms.texture.value = this.textures[sprite_index]\n  }\n\n  removeHighlights() {\n    let highlight_container = this.scene.children[1]\n    let highlights = highlight_container.children\n    highlight_container.remove(...highlights)\n  }\n\n  checkIntersects(mouse_position) {\n\n    let { width, height, sidebar_ctx, sidebar_image_size, txt, txt_embeddings } = this.props\n\n    function mouseToThree([mouseX, mouseY]) {\n      return new THREE.Vector3(\n        (mouseX / width) * 2 - 1,\n        -(mouseY / height) * 2 + 1,\n        1\n      )\n    }\n\n\n    this.getScaleFromZ(this.camera.position.z)\n\n    function sortIntersectsByDistanceToRay(intersects) {\n      return _.sortBy(intersects, 'distanceToRay')\n    }\n\n    let mouse_vector = mouseToThree(mouse_position)\n    this.raycaster.setFromCamera(mouse_vector, this.camera)\n    this.raycaster.params.Points.threshold = 0.25\n    let intersects = this.raycaster.intersectObjects(\n      this.scene.children[0].children\n    )\n\n    \n   //console.log(this.scene.children)\n    if (intersects[0]) {\n      console.log(\"hovered over image\")\n      let sorted_intersects = sortIntersectsByDistanceToRay(intersects)\n      let intersect = sorted_intersects[0]\n      let sprite_index = intersect.object.userData.sprite_index\n      let digit_index = intersect.index\n      let full_index = sprite_index * sprite_size + digit_index\n      this.props.setHoverIndex(full_index)\n      this.highlightPoint(sprite_index, digit_index, full_index)\n      this.scene.children[1].visible = true\n\n      sidebar_ctx.fillRect(0, 0, sidebar_image_size, sidebar_image_size)\n      sidebar_ctx.drawImage(\n        mnist_images[sprite_index],\n        // source rectangle\n        (digit_index % sprite_side) * sprite_image_size,\n        Math.floor(digit_index / sprite_side) * sprite_image_size,\n        sprite_image_size,\n        sprite_image_size,\n        // destination rectangle\n        0,\n        0,\n        sidebar_image_size,\n        sidebar_image_size\n      )\n    } else {\n      this.props.setHoverIndex(null)\n      this.scene.children[1].visible = false\n      sidebar_ctx.fillRect(0, 0, sidebar_image_size, sidebar_image_size)\n      //var div = document.getElementById('text');\n      //div.innerHTML = \"\";\n    }\n\n    let intersects_text = this.raycaster.intersectObjects(\n      this.scene.children[2].children\n    )\n    if (intersects_text[0]) {\n      console.log(\"hello\")\n      let sorted_intersects = sortIntersectsByDistanceToRay(intersects_text)\n      let intersect = sorted_intersects[0]\n      let text_index = intersect.object.userData\n      //this.pointsContainer.children[0].geometry.colors[intersect.index] = {r: 1, g: 0, b: 0}\n      this.pointsContainer.children[0].geometry.colors[intersect.index].r = 1\n      //console.log(intersect, txt[intersect.index],this.pointsContainer.children[0].geometry.colors[intersect.index].r)\n      \n      var selectedObject = this.scene.getObjectByName(\"tooltip\");\n      console.log(this.getScaleFromZ(this.camera.position.z))\n      this.scene.remove( selectedObject )\n      var mul = 120\n      //if (selectedObject === undefined){\n        var spritey = this.makeTextSprite( txt[intersect.index].slice(0, 30)+\"...\", \n          { fontsize: 18, textColor: {r:0, g:0, b:0, a:1},borderColor: {r:0, g:0, b:0, a:1},backgroundColor: {r:255, g:255, b:255, a:1}} );\n              spritey.position.set(txt_embeddings[intersect.index][0]+0.5,txt_embeddings[intersect.index][1]-0.5,0.5);\n              spritey.name = \"tooltip\"\n              spritey.scale.x=2/this.getScaleFromZ(this.camera.position.z)*mul\n              spritey.scale.y=1/this.getScaleFromZ(this.camera.position.z)*mul\n      \n              this.scene.add( spritey );  \n      //}\n     \n      console.log(this.scene.children[0])\n      var div = document.getElementById('text');\n\n      div.innerHTML = txt[intersect.index];\n    } else {\n      var selectedObject = this.scene.getObjectByName(\"tooltip\");\n      this.props.setHoverIndex(null)\n      this.scene.remove( selectedObject )\n      }\n  }\n\n  handleMouse() {\n    let view = d3.select(this.renderer.domElement)\n\n    this.raycaster = new THREE.Raycaster()\n\n    view.on('mousemove', () => {\n    if(!d3.event.shiftKey){\n        let [mouseX, mouseY] = d3.mouse(view.node())\n        let mouse_position = [mouseX, mouseY]\n        this.checkIntersects(mouse_position)\n    }})\n  }\n\n  handlelasso(){\n\n    let { width, height, sidebar_ctx, sidebar_image_size } = this.props\n\n    function mouseToThree([mouseX, mouseY],scale) {\n      return new THREE.Vector3(\n        scale*(( mouseX /width ) * 2 - 1.5),\n        -scale*((mouseY / height) * 2 - 1),\n        1\n      )\n    }\n\n    function mouseToCoords([mouseX, mouseY],scale) {\n        return [\n          scale*(( mouseX /width ) * 2 - 1.5),\n          -scale*((mouseY / height) * 2 - 1),\n        ]\n      }\n\n\n\n    this.selectionPoints = [];\n    const material = new THREE.LineBasicMaterial( { color: 0x0000ff } );\n            \n\n\n\n\tthis.renderer.domElement.addEventListener( 'pointerdown', e => {\n        this.lasso = [];\n\t\tthis.selectionPoints.length = 0;\n        this.points = []\n        this.points.push( mouseToCoords([e.clientX, e.clientY ],this.getScaleFromZ(this.camera.position.z)) );\n        this.lasso.push( mouseToThree([e.clientX, e.clientY ],this.getScaleFromZ(this.camera.position.z)) );\n\n        \n\t} );\n\n\tthis.renderer.domElement.addEventListener( 'pointerup', () => {\n        console.log(this.points)\n        let { img_embeddings } = this.props\n        this.checkinside(img_embeddings, this.points)\n        \n        \n    })\n\n    this.renderer.domElement.addEventListener( 'pointermove', e => {\n\n\t\t// If the left mouse button is not pressed\n\t\tif ( ( 1 & e.buttons ) === 0 ) {\n\n\t\t\treturn;\n\n\t\t}\n        this.points.push(mouseToCoords([e.clientX, e.clientY ],this.getScaleFromZ(this.camera.position.z)));    \n        this.lasso.push(mouseToThree([e.clientX, e.clientY ],this.getScaleFromZ(this.camera.position.z)));    \n\n        const geometry = new THREE.BufferGeometry().setFromPoints( this.lasso );\n\n        const line = new THREE.Line( geometry, material );\n        this.scene.add( line );\n    \n    } );\n\n  }\n\n  checkinside(points, polygon){\n    var pointsinside = points.map(point => {\n        return pointInPolygon(point, polygon);\n    });\n    const arrsum = arr => arr.reduce((a,b) => a*1.0 + b*1.0, 0)\n    console.log(arrsum(pointsinside))\n\n    \n\n\n  }\n\n\n  init() {\n    let { width, height } = this.props\n\n    this.scene = new THREE.Scene()\n    this.scene.background = new THREE.Color( '#ffffff' );\n\n\n    let vFOV = 15\n    let aspect = width / height\n    let near = 0.02\n    let far = 1000\n\n    this.camera = new THREE.PerspectiveCamera(vFOV, aspect, near, far)\n    this.renderer = new THREE.WebGLRenderer()\n    this.renderer.setClearColor(0x111111, 1)\n    this.renderer.setSize(width, height)\n    this.mount.appendChild(this.renderer.domElement)\n\n    this.addPoints()\n\n    this.addBlankHighlightPoints()\n\n    this.setUpCamera()\n\n    this.animate()\n\n    this.handleMouse()\n\n    //this.addtexts()\n    this.addTextPoints()\n    //this.addImgPoints()\n    //this.handlelasso()\n\n  }\n\n  animate() {\n    requestAnimationFrame(this.animate)\n    TWEEN.update()\n    this.renderer.render(this.scene, this.camera)\n  }\n\n  componentDidMount() {\n    this.init()\n  }\n\n  componentDidUpdate(prevProps) {\n\n    let { width, height } = this.props\n    if (width !== prevProps.width || height !== prevProps.height) {\n      this.handleResize(width, height)\n    }\n    if (prevProps.model_choice !== this.props.model_choice) {\n      this.changeEmbeddings(\n        prevProps.model_choice,\n        this.props.model_choice\n      )\n    }\n  }\n\n  componentWillUnmount() {\n    this.mount.removeChild(this.renderer.domElement)\n  }\n\n  render() {\n    let { width, height } = this.props\n    return (\n      <div\n        style={{ width: width, height: height, overflow: 'hidden' }}\n        ref={mount => {\n          this.mount = mount\n        }}\n      />\n    )\n  }\n}\n\nexport default Projection\n","import React, { Component } from 'react'\nimport Markdown from 'react-remarkable'\nimport { about_text } from './Content'\n\nclass About extends Component {\n  render() {\n    let { grem, p } = this.props\n    return (\n      <div\n        style={{\n          position: 'fixed',\n          left: 0,\n          top: 0,\n          right: 0,\n          bottom: 0,\n          background: '#222',\n          color: '#fff',\n          paddingTop: grem * 2,\n          overflowY: 'auto',\n          fontSize: 16,\n          lineHeight: 1.5,\n        }}\n      >\n        <div\n          style={{\n            background: '#333',\n            position: 'fixed',\n            left: 0,\n            top: 0,\n            right: 0,\n            padding: grem / 2,\n          }}\n        >\n          About\n          <button\n            onClick={() => {\n              this.props.toggleAbout(false)\n            }}\n            className=\"hover-555\"\n            style={{\n              position: 'absolute',\n              right: 0,\n              top: 0,\n              height: grem * 2,\n              width: grem * 2,\n              padding: grem / 2,\n              textAlign: 'center',\n              cursor: 'pointer',\n              textDecoration: 'none',\n            }}\n          >\n            &times;\n          </button>\n        </div>\n        <div\n          style={{\n            maxWidth: grem * 30,\n            margin: '0 auto',\n            padding: grem / 2,\n            color: '#fff',\n          }}\n        >\n          <Markdown>{about_text}</Markdown>\n        </div>\n      </div>\n    )\n  }\n}\n\nexport default About\n","export let about_text = `\n# About EmbedAnything\nThis is an interactive visualization that embeds, clusters and analyses multimodal data.`\n","import React, { Component } from 'react'\nimport Sidebar from './Sidebar'\nimport Projection from './Projection'\nimport About from './About'\nimport * as _ from 'lodash'\n\n// padding constructor\nfunction p(tb, lr) {\n  return `${tb}px ${lr}px`\n}\n\nlet color_array = [\n  [141, 211, 199],\n  [255, 255, 179],\n  [190, 186, 218],\n  [251, 128, 114],\n  [128, 177, 211],\n  [253, 180, 98],\n  [179, 222, 105],\n  [252, 205, 229],\n  [188, 128, 189],\n  [141, 211, 199],\n  [255, 255, 179],\n  [190, 186, 218],\n  [251, 128, 114],\n  [128, 177, 211],\n  [253, 180, 98],\n  [179, 222, 105],\n  [252, 205, 229],\n  [188, 128, 189],\n  [141, 211, 199],\n  [255, 255, 179],\n  [190, 186, 218],\n  [251, 128, 114],\n  [128, 177, 211],\n  [253, 180, 98],\n  [179, 222, 105],\n  [252, 205, 229],\n  [188, 128, 189],\n  [141, 211, 199],\n  [255, 255, 179],\n  [190, 186, 218],\n  [251, 128, 114],\n  [128, 177, 211],\n  [253, 180, 98],\n  [179, 222, 105],\n  [252, 205, 229],\n  [188, 128, 189],\n  [141, 211, 199],\n  [255, 255, 179],\n  [190, 186, 218],\n  [251, 128, 114],\n  [128, 177, 211],\n  [253, 180, 98],\n  [179, 222, 105],\n  [252, 205, 229],\n  [188, 128, 189],\n  [141, 211, 199],\n  [255, 255, 179],\n  [190, 186, 218],\n  [251, 128, 114],\n  [128, 177, 211],\n  [253, 180, 98],\n  [179, 222, 105],\n  [252, 205, 229],\n  [188, 128, 189],\n  [141, 211, 199],\n  [255, 255, 179],\n  [190, 186, 218],\n  [251, 128, 114],\n  [128, 177, 211],\n  [253, 180, 98],\n  [179, 222, 105],\n  [252, 205, 229],\n  [188, 128, 189],\n]\n\nclass Layout extends Component {\n  constructor(props) {\n    super(props)\n    this.state = {\n      ww: null,\n      wh: null,\n      sidebar_height: null,\n      hover_index: null,\n      show_about: null,\n      algorithm_choice: 0,\n      model_choice:0,\n      dataset_choice:0\n    }\n    this.sidebar_ctx = null\n    this.setSize = _.debounce(this.setSize.bind(this), 200)\n    this.checkHash = this.checkHash.bind(this)\n    this.setSidebarCanvas = this.setSidebarCanvas.bind(this)\n    this.toggleAbout = this.toggleAbout.bind(this)\n    this.selectAlgorithm = this.selectAlgorithm.bind(this)\n    this.selectModel = this.selectModel.bind(this)\n    this.selectDataset = this.selectDataset.bind(this)\n  }\n\n  selectAlgorithm(v) {\n    let i = this.props.algorithm_options.indexOf(v)\n    this.setState({ algorithm_choice: i })\n  }\n\n  selectModel(v) {\n    let i = this.props.model_options.indexOf(v)\n    this.setState({ model_choice: i })\n  }\n\n  selectDataset(v) {\n    let i = this.props.dataset_options.indexOf(v)\n    console.log(this.props.dataset_options)\n    this.setState({ dataset_choice: i })\n  }\n\n\n  setSize() {\n    this.setState({ ww: window.innerWidth, wh: window.innerHeight })\n    let sidebar_height = this.sidebar_mount.offsetHeight\n    this.setState({ sidebar_height: sidebar_height })\n    if (this.sidebar_ctx) this.sidebar_ctx.imageSmoothingEnabled = false\n  }\n\n  setSidebarCanvas(canvas) {\n    let ctx = canvas.getContext('2d')\n    ctx.imageSmoothingEnabled = false\n    this.sidebar_ctx = ctx\n  }\n\n  toggleAbout(state) {\n    if (state === true) {\n      window.history.pushState(null, 'About UMAP Explorer', '#about')\n      this.setState({ show_about: true })\n    } else if (state === false) {\n      window.history.pushState(null, 'UMAP Explorer', window.location.pathname)\n      this.setState({ show_about: false })\n    }\n  }\n\n  setHoverIndex(hover_index) {\n    this.setState({ hover_index: hover_index })\n  }\n\n  componentWillMount() {\n    this.setSize()\n    this.checkHash()\n  }\n\n  checkHash() {\n    if (window.location.hash && window.location.hash === '#about') {\n      this.setState({ show_about: true })\n    } else {\n      this.setState({ show_about: false })\n    }\n  }\n\n  componentDidMount() {\n    window.addEventListener('resize', this.setSize)\n    window.addEventListener('popstate', this.checkHash)\n  }\n\n  componentWillUnmount() {\n    window.removeEventListener('resize', this.setSize)\n  }\n\n  handleChangeScale(e,val) {\n    this.setState({ scaleMin: val})\n    console.log(val)\n  }\n\n  ////////\n  render() {\n    let {\n      mnist_embeddings,\n      txt,\n      txt_embeddings,\n      img_embeddings,\n      clip_img_embeddings,\n      clip_txt_embeddings,\n      mnist_labels,\n      algorithm_options,\n      model_options,\n      dataset_options,\n      algorithm_embedding_keys,\n      model_embedding_keys,\n      img_labels,\n      scaleMin,\n      scaleMax,\n    } = this.props\n    let {\n      ww,\n      wh,\n      sidebar_height,\n      hover_index,\n      show_about,\n      model_choice,\n      algorithm_choice,\n      dataset_choice\n    } = this.state\n    let sidebar_ctx = this.sidebar_ctx\n\n    let line_height = 1.5\n\n    let sidebar_style = {\n      position: 'absolute',\n      left: 0,\n      top: 0,\n      height: '100vh',\n      overflow: 'auto',\n      background: '#222',\n      display: 'flex',\n      flexDirection: 'column',\n    }\n    let main_style = {\n      position: 'relative',\n      height: '100vh',\n      background: '#111',\n      overflow: 'hidden',\n    }\n\n    let sidebar_image_size, sidebar_orientation\n    let font_size = 16\n    if (ww < 800) {\n      font_size = 14\n      sidebar_style = {\n        ...sidebar_style,\n        flexDirection: 'row',\n        width: '100%',\n        top: 'auto',\n        height: 'auto',\n        bottom: 0,\n      }\n      main_style = { width: ww, height: wh - sidebar_height }\n      sidebar_image_size = font_size * line_height * 3\n      sidebar_orientation = 'horizontal'\n    } else if (ww < 800 + 600) {\n      let scaler = 200 + (300 - 200) * ((ww - 800) / 600)\n      font_size = 14 + 2 * ((ww - 800) / 600)\n      sidebar_style = {\n        ...sidebar_style,\n        width: scaler,\n      }\n      sidebar_image_size = sidebar_style.width\n      main_style = {\n        ...main_style,\n        width: ww - scaler,\n        left: scaler,\n        height: wh,\n      }\n      sidebar_orientation = 'vertical'\n    } else {\n      sidebar_style = {\n        ...sidebar_style,\n        width: 300,\n      }\n      main_style = {\n        ...main_style,\n        width: ww - 300,\n        left: 300,\n        height: wh,\n      }\n      sidebar_image_size = sidebar_style.width\n      sidebar_orientation = 'vertical'\n    }\n\n    let grem = font_size * line_height\n\n    let general_style = {\n      fontSize: font_size,\n      lineHeight: line_height,\n    }\n\n    return ww !== null ? (\n      <div style={general_style}>\n        <div\n          style={sidebar_style}\n          ref={sidebar_mount => {\n            this.sidebar_mount = sidebar_mount\n          }}\n        >\n          <Sidebar\n            sidebar_orientation={sidebar_orientation}\n            sidebar_image_size={sidebar_image_size}\n            grem={grem}\n            p={p}\n            color_array={color_array}\n            setSidebarCanvas={this.setSidebarCanvas}\n            hover_index={hover_index}\n            mnist_labels={mnist_labels}\n            txt={txt}\n            toggleAbout={this.toggleAbout}\n            algorithm_options={algorithm_options}\n            algorithm_choice={algorithm_choice}\n            selectAlgorithm={this.selectAlgorithm}\n            model_options={model_options}\n            model_choice={model_choice}\n            selectModel={this.selectModel}\n            dataset_options={dataset_options}\n            dataset_choice={dataset_choice}\n            selectDataset={this.selectDataset}\n            img_labels={img_labels}\n            scaleMin = {scaleMin}\n            scaleMax = {scaleMax}\n            handleChangeScale = {this.handleChangeScale}\n          />\n        </div>\n        <div style={main_style}>\n          <Projection\n            width={main_style.width}\n            height={main_style.height}\n            mnist_embeddings={mnist_embeddings}\n            txt={txt}\n            txt_embeddings={txt_embeddings} \n            img_embeddings={img_embeddings} \n            clip_img_embeddings={clip_img_embeddings}\n            clip_txt_embeddings={clip_txt_embeddings}\n            mnist_labels={mnist_labels}\n            color_array={color_array}\n            sidebar_ctx={sidebar_ctx}\n            sidebar_image_size={sidebar_image_size}\n            setHoverIndex={this.setHoverIndex.bind(this)}\n            algorithm_embedding_keys={algorithm_embedding_keys}\n            algorithm_choice={algorithm_choice}\n            model_embedding_keys={model_embedding_keys}\n            model_choice={model_choice}\n            scaleMin = {10}\n            scaleMax = {500}\n          />\n        </div>\n\n\n        \n        {show_about ? (\n          <About grem={grem} p={p} toggleAbout={this.toggleAbout} />\n        ) : null}\n      </div>\n    ) : (\n      <div style={{ padding: '1rem' }}>Loading projections...</div>\n    )\n  }\n}\n\nexport default Layout\n","import React, { Component } from 'react'\nimport Layout from './Layout'\nimport * as _ from 'lodash'\nimport * as d3 from 'd3'\nimport { AppContext } from './AppContext'\n\n\nlet algorithm_options = ['UMAP',]\nlet algorithm_embedding_keys = [\n  'mnist_embeddings',\n]\n\n\n\nvar dataset_name = 'visiogen_'//'wiki_'//'wiki_' \nvar model_name = 'clip_'//'ib_' 'clip_'\n\n\nlet model_options = [dataset_name]//['Imagebind', 'CLIP']\nlet model_embedding_keys = [\n  '',\n  'clip_',\n]\n\nlet dataset_options = [model_name]//['Visiogender',\"Wiki\"]\n\n\nclass Data extends Component {\n  constructor(props) {\n    super(props)\n    this.state = {\n      mnist_embeddings: null,\n      mnist_labels: null,\n      md08_umap_mnist_embeddings: null,\n      txt_embeddings: null,\n\n    }\n  }\n\n  scaleEmbeddings(embeddings) {\n    let xs = embeddings.map(e => Math.abs(e[0]))\n    let ys = embeddings.map(e => Math.abs(e[1]))\n    let max_x = _.max(xs)\n    let max_y = _.max(ys)\n    let max = Math.max(max_x, max_y)\n    let scale = d3\n      .scaleLinear()\n      .domain([-max, max])\n      .range([-20, 20])\n    let scaled_embeddings = embeddings.map(e => [scale(e[0]), scale(e[1])])\n    return scaled_embeddings\n  }\n\n  componentDidMount() {\n    fetch(`${process.env.PUBLIC_URL}/mnist_embeddings.json`)\n      .then(response => response.json())\n      .then(mnist_embeddings => {\n        let scaled_embeddings = this.scaleEmbeddings(mnist_embeddings)\n        this.setState({\n          mnist_embeddings: scaled_embeddings,\n        })\n      })\n\n    fetch(`${process.env.PUBLIC_URL}/mnist_labels.json`)\n      .then(response => response.json())\n      .then(mnist_labels =>\n        this.setState({\n          mnist_labels: mnist_labels,\n        })\n      )\n\n      fetch(`${process.env.PUBLIC_URL}/data/`+dataset_name+model_name+`txt_embeddings.json`)\n      .then(response => response.json())\n      .then(txt_embeddings => {\n        let scaled_embeddings = this.scaleEmbeddings(txt_embeddings)\n        this.setState({\n          txt_embeddings: scaled_embeddings,\n        })\n      })\n\n\n      fetch(`${process.env.PUBLIC_URL}/data/`+dataset_name+model_name+`img_embeddings.json`)\n      .then(response => response.json())\n      .then(img_embeddings => {\n        let scaled_embeddings = this.scaleEmbeddings(img_embeddings)\n        this.setState({\n          img_embeddings: scaled_embeddings,\n        })\n      })\n\n\n      fetch(`${process.env.PUBLIC_URL}/data/`+dataset_name+`txt.json`)\n      .then(response => response.json())\n      .then(txt => {\n        this.setState({\n          txt: txt,\n        })\n      })\n\n\n\n      fetch(`${process.env.PUBLIC_URL}/data/`+dataset_name+`img_labels.json`)\n      .then(response => response.json())\n      .then(img_labels => {\n        this.setState({\n          img_labels: img_labels\n        })\n      })\n\n\n\n\n      \n  }\n\n  \n\n  render() {\n    return this.state.mnist_embeddings && this.state.mnist_labels ? (\n      <Layout\n        {...this.state}\n        algorithm_options={algorithm_options}\n        model_options={model_options}\n        dataset_options={dataset_options}\n        algorithm_embedding_keys={algorithm_embedding_keys}\n        model_embedding_keys={model_embedding_keys}\n      />\n    ) : (\n      <div style={{ padding: '1rem' }}>Loading data...</div>\n    )\n  }\n}\n\nexport default Data\n","// Define a context that will be shared within all the app.\n//Ref: https://4geeks.com/lesson/context-api\n\nimport React, { useState, useContext } from \"react\";\nimport * as d3 from \"d3\";\n\n\nexport const AppContext = React.createContext(null);\n// Create a ContextWrapper component that has to be the parent of every consumer.\n\n\nexport const ContextWrapper = (props) => {\n\n  function generateColor (n) {\n\n    return Array.from({length: n}, () => '#' +  Math.random().toString(16).substr(-6));\n  }\n  \n\n  function makedata(width,height)\n  {\n    const rngx = d3.randomNormal(width / 2, Math.min(width, height) / 5),\n      rngy = d3.randomNormal(height / 2, Math.min(width, height) / 5);\n      let txt = \"Placeholder text\";\n    return Array.from({ length: 100000 }, () => [rngx(), rngy(), txt]);\n  }\n\n  // Gets centroid of set of points\nfunction getCentroid(points) {\n\n  var first = points[0],\n    last = points[points.length - 1];\n  if (first.x !== last.x || first.y !== last.y) points.push(first);\n  var twicearea = 0,\n    x = 0,\n    y = 0,\n    nPoints = points.length,\n    p1,\n    p2,\n    f;\n  for (var i = 0, j = nPoints - 1; i < nPoints; j = i++) {\n    p1 = points[i];\n    p2 = points[j];\n    f = p1.x * p2.y - p2.x * p1.y;\n    twicearea += f;\n    x += (p1.x + p2.x) * f;\n    y += (p1.y + p2.y) * f;\n  }\n  f = twicearea * 3;\n  console.log(points, x,y)\n  return { x: x / f, y: y / f };\n}\n  \n\n    //For making projections\n    const [xscale,setXscale] = useState()\n    const [yscale,setYscale] = useState()\n    \n    const [scaleMin,setScaleMin,] = useState()\n    const [zoomselected,setZoomselected] = useState(false)\n    const [zoomscale,setZoomscale] = useState(1)\n    const [cameraOffset,setCameraOffset] = useState({ x: 0, y: 0 })\n    const [prevselected, setPrevselected] = useState([])\n    const [lastselected, setLastselected] = useState([])\n    const [clusterk, setClusterk] = useState(1)\n\n\n    const [clustercolors, setClustercolors] = useState(generateColor(100))\n    const [autoclustercolors, setAutoclustercolors] = useState(generateColor(100))\n    const [clusterlabels, setClusterLabels] = useState([])\n\n    \n    const [searched, setSearched] = useState([])\n\n    const [prevlasso, setPrevlasso] = useState([])\n    const [lassoed, setLassoed] = useState([])\n    const [lassocentroid, setLassocentroid] = useState([])\n    const [isinsidelasso, setIsinsidelasso] = useState([])\n    const [getexplain, setGetexplain] = useState(false)\n \n    const DEFAULT_PROMPT =\n    \"What is the common theme between the selected sentences?\";\n    \n    const [apikey, setApikey] = useState(\"\");\n    const [topknumber, setTopknumber] = useState(30);\n    const [makecloud, setMakecloud,] = useState(false);\n    const [poswords, setPoswords] = useState([]);\n    const [topwords, setTopwords] = useState([]);\n    const [prompt, setPrompt] = useState(DEFAULT_PROMPT);\n    const [langexplanation, setLangexplanation] = useState(\n      \"Select points to see an explanation\"\n    );\n\n    const [testtext, setTesttext] = useState(DEFAULT_PROMPT);\n\n\n\n    const localDevURL = \"http://127.0.0.1:8000/\";\n\n\n\n\n\n    const value = {\n\n        //\n        scaleMin,setScaleMin,\n        zoomscale,setZoomscale,\n        zoomselected,setZoomselected,\n        cameraOffset,setCameraOffset,\n        lassoed, setLassoed,\n        lassocentroid, setLassocentroid,\n        searched, setSearched,\n        prevlasso, setPrevlasso,\n        prevselected, setPrevselected,\n        lastselected, setLastselected,\n        clustercolors, setClustercolors,\n        autoclustercolors, setAutoclustercolors,\n        clusterk, setClusterk,\n        xscale,setXscale,\n        yscale,setYscale,\n        //\n        DEFAULT_PROMPT,\n        localDevURL,\n        //\n        apikey, setApikey, \n        prompt, setPrompt,\n        topknumber, setTopknumber,\n        makecloud, setMakecloud,\n        poswords, setPoswords,\n        topwords, setTopwords,\n        langexplanation, setLangexplanation,\n        isinsidelasso, setIsinsidelasso,\n        getexplain, setGetexplain,\n        testtext, setTesttext,\n\n      };\n\t\n\treturn (\n\t\t<AppContext.Provider value={value}>\n\t\t\t{props.children}\n\t\t</AppContext.Provider>\n\t);\n}","import React, { Component } from 'react'\nimport './App.css'\nimport Data from './Data'\n\nclass App extends Component {\n  render() {\n    return <Data />\n  }\n}\n\nexport default App\n","// This optional code is used to register a service worker.\n// register() is not called by default.\n\n// This lets the app load faster on subsequent visits in production, and gives\n// it offline capabilities. However, it also means that developers (and users)\n// will only see deployed updates on subsequent visits to a page, after all the\n// existing tabs open on the page have been closed, since previously cached\n// resources are updated in the background.\n\n// To learn more about the benefits of this model and instructions on how to\n// opt-in, read http://bit.ly/CRA-PWA\n\nconst isLocalhost = Boolean(\n  window.location.hostname === 'localhost' ||\n    // [::1] is the IPv6 localhost address.\n    window.location.hostname === '[::1]' ||\n    // 127.0.0.1/8 is considered localhost for IPv4.\n    window.location.hostname.match(\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\n    )\n);\n\nexport function register(config) {\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\n    // The URL constructor is available in all browsers that support SW.\n    const publicUrl = new URL(process.env.PUBLIC_URL, window.location.href);\n    if (publicUrl.origin !== window.location.origin) {\n      // Our service worker won't work if PUBLIC_URL is on a different origin\n      // from what our page is served on. This might happen if a CDN is used to\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\n      return;\n    }\n\n    window.addEventListener('load', () => {\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\n\n      if (isLocalhost) {\n        // This is running on localhost. Let's check if a service worker still exists or not.\n        checkValidServiceWorker(swUrl, config);\n\n        // Add some additional logging to localhost, pointing developers to the\n        // service worker/PWA documentation.\n        navigator.serviceWorker.ready.then(() => {\n          console.log(\n            'This web app is being served cache-first by a service ' +\n              'worker. To learn more, visit http://bit.ly/CRA-PWA'\n          );\n        });\n      } else {\n        // Is not localhost. Just register service worker\n        registerValidSW(swUrl, config);\n      }\n    });\n  }\n}\n\nfunction registerValidSW(swUrl, config) {\n  navigator.serviceWorker\n    .register(swUrl)\n    .then(registration => {\n      registration.onupdatefound = () => {\n        const installingWorker = registration.installing;\n        if (installingWorker == null) {\n          return;\n        }\n        installingWorker.onstatechange = () => {\n          if (installingWorker.state === 'installed') {\n            if (navigator.serviceWorker.controller) {\n              // At this point, the updated precached content has been fetched,\n              // but the previous service worker will still serve the older\n              // content until all client tabs are closed.\n              console.log(\n                'New content is available and will be used when all ' +\n                  'tabs for this page are closed. See http://bit.ly/CRA-PWA.'\n              );\n\n              // Execute callback\n              if (config && config.onUpdate) {\n                config.onUpdate(registration);\n              }\n            } else {\n              // At this point, everything has been precached.\n              // It's the perfect time to display a\n              // \"Content is cached for offline use.\" message.\n              console.log('Content is cached for offline use.');\n\n              // Execute callback\n              if (config && config.onSuccess) {\n                config.onSuccess(registration);\n              }\n            }\n          }\n        };\n      };\n    })\n    .catch(error => {\n      console.error('Error during service worker registration:', error);\n    });\n}\n\nfunction checkValidServiceWorker(swUrl, config) {\n  // Check if the service worker can be found. If it can't reload the page.\n  fetch(swUrl)\n    .then(response => {\n      // Ensure service worker exists, and that we really are getting a JS file.\n      const contentType = response.headers.get('content-type');\n      if (\n        response.status === 404 ||\n        (contentType != null && contentType.indexOf('javascript') === -1)\n      ) {\n        // No service worker found. Probably a different app. Reload the page.\n        navigator.serviceWorker.ready.then(registration => {\n          registration.unregister().then(() => {\n            window.location.reload();\n          });\n        });\n      } else {\n        // Service worker found. Proceed as normal.\n        registerValidSW(swUrl, config);\n      }\n    })\n    .catch(() => {\n      console.log(\n        'No internet connection found. App is running in offline mode.'\n      );\n    });\n}\n\nexport function unregister() {\n  if ('serviceWorker' in navigator) {\n    navigator.serviceWorker.ready.then(registration => {\n      registration.unregister();\n    });\n  }\n}\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport App from './App';\nimport * as serviceWorker from './serviceWorker';\n\nReactDOM.render(<App />, document.getElementById('root'));\n\n// If you want your app to work offline and load faster, you can change\n// unregister() to register() below. Note this comes with some pitfalls.\n// Learn more about service workers: http://bit.ly/CRA-PWA\nserviceWorker.unregister();\n"],"sourceRoot":""}