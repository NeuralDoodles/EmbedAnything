(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{133:function(e,t,n){"use strict";n.r(t);var a=n(0),i=n.n(a),r=n(43),o=n.n(r),s=(n(69),n(11)),l=n(12),c=n(14),d=n(13),h=n(15),u=(n(71),n(17)),m=n(2),v=n(141),g=function(e){function t(){return Object(s.a)(this,t),Object(c.a)(this,Object(d.a)(t).apply(this,arguments))}return Object(h.a)(t,e),Object(l.a)(t,[{key:"componentDidMount",value:function(){this.props.setSidebarCanvas(this.side_canvas),this.handleSelectAlgorithm=this.handleSelectAlgorithm.bind(this),this.handleSelectModel=this.handleSelectModel.bind(this),this.handleSelectDataset=this.handleSelectDataset.bind(this),this.handleChangScaleMin=this.handleChangScaleMin.bind(this)}},{key:"handleSelectAlgorithm",value:function(e){var t=e.target.value;this.props.selectAlgorithm(t)}},{key:"handleSelectModel",value:function(e){var t=e.target.value;this.props.selectModel(t)}},{key:"handleSelectDataset",value:function(e){var t=e.target.value;this.props.selectDataset(t)}},{key:"handleChangScaleMin",value:function(e){var t=e.target.value;this.props.selectScaleMin(t),console.log(this.props)}},{key:"render",value:function(){var e=this,t=this.props,n=t.sidebar_orientation,a=t.sidebar_image_size,r=t.grem,o=t.p,s=t.hover_index,l=(t.mnist_labels,t.color_array),c=t.model_options,d=t.model_choice,h=t.dataset_options,u=t.dataset_choice,m=(t.algorithm_options,t.algorithm_choice,t.img_labels),g=t.scaleMin;return i.a.createElement("div",{style:{display:"flex",flexDirection:"column",justifyContent:"space-between",flexGrow:1}},i.a.createElement("div",null," ",i.a.createElement("div",{style:{padding:r/2,display:"flex",justifyContent:"space-between",alignItems:"center"}},i.a.createElement("div",null,"Emebedding Model:"),i.a.createElement("select",{style:{width:100},onChange:this.handleSelectModel,value:c[d]},c.map(function(e,t){return i.a.createElement("option",{key:e,value:e},e)}))),i.a.createElement("div",{style:{padding:r/2,display:"flex",justifyContent:"space-between",alignItems:"center"}},i.a.createElement("div",null,"Dataset:"),i.a.createElement("select",{style:{width:100},onChange:this.handleSelectDataset,value:h[u]},h.map(function(e,t){return i.a.createElement("option",{key:e,value:e},e)}))),i.a.createElement("div",{style:{display:"flex",flexDirection:"horizontal"===n?"row":"column"}},i.a.createElement("div",null,i.a.createElement("canvas",{ref:function(t){e.side_canvas=t},width:a,height:a})),i.a.createElement("div",{style:{flexGrow:1}},i.a.createElement("div",{style:{background:s?"rgb(".concat(l[Math.round(10*Math.random())].join(","),")"):"transparent",color:s?"#000":"#fff",padding:o(r/4,r/2),display:"flex",justifyContent:"space-between",transition:"all 0.1s linear"}},i.a.createElement("div",null,"Label:"),s?i.a.createElement("div",null,m[s]):null),i.a.createElement("div",{style:{padding:o(r/4,r/2),display:"flex",justifyContent:"space-between"}},"Image Index:",s?i.a.createElement("div",null,s):null),i.a.createElement("hr",null),i.a.createElement("div",{id:"text",style:{padding:o(r/4,r/2),display:"flex",justifyContent:"space-between",overflowY:"scroll",float:"left",height:"200px"}})),i.a.createElement("div",{style:{padding:o(r/4,r/2),justifyContent:"space-between"}},i.a.createElement("br",null)," ",i.a.createElement("br",null),i.a.createElement("br",null)," ",i.a.createElement("br",null),i.a.createElement("b",null,"Scroll up/down to zoom in/out, hover for more info on datapoints",i.a.createElement("br",null)," ",i.a.createElement("br",null),"Image and Text are jointly embedded and visualized using UMAP",i.a.createElement("br",null)," ",i.a.createElement("br",null),"Label and index will be used if additional metadata is included."))),i.a.createElement("div",{id:"display_settings"},i.a.createElement(v.a,{"aria-label":"Volume",value:g,onChange:this.handleChangScaleMin}))),i.a.createElement("div",{style:{padding:r/2}},i.a.createElement("div",null,"A WIP Multimodal embedding viewer."," ",i.a.createElement("button",{onClick:function(){e.props.toggleAbout(!0)}},"About"))))}}]),t}(a.Component),f=n(5),p=n(9),b=n(1),y=n(10),_=n(7),w=n(18);function x(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return j(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return j(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var a=0,i=function(){};return{s:i,n:function(){return a>=e.length?{done:!0}:{done:!1,value:e[a++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var r,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,r=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw r}}}}function j(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,a=new Array(t);n<t;n++)a[n]=e[n];return a}var S=n(78),k=Object(p.a)(Array(8)).map(function(e,t){return"".concat("/EmbedAnything","/sprites/").concat("fairface_tile_").concat(t,".png")});console.log(k);var O=k.map(function(e){var t=document.createElement("img");return t.src=e,t}),E=function(e){function t(e){var n;return Object(s.a)(this,t),(n=Object(c.a)(this,Object(d.a)(t).call(this,e))).handleResize=function(e,t){n.camera.aspect=e/t,n.camera.updateProjectionMatrix(),n.renderer.setSize(e,t);var a=n.getScaleFromZ(n.camera.position.z),i=-n.camera.position.x*a+n.props.width/2,r=n.camera.position.y*a+n.props.height/2,o=_.f.translate(i,r).scale(a),s=_.d(n.mount);n.d3_zoom.transform(s,o)},n.state={},n.init=n.init.bind(Object(m.a)(Object(m.a)(n))),n.addPoints=n.addPoints.bind(Object(m.a)(Object(m.a)(n))),n.handleResize=n.handleResize.bind(Object(m.a)(Object(m.a)(n))),n.setUpCamera=n.setUpCamera.bind(Object(m.a)(Object(m.a)(n))),n.animate=n.animate.bind(Object(m.a)(Object(m.a)(n))),n.getScaleFromZ=n.getScaleFromZ.bind(Object(m.a)(Object(m.a)(n))),n.getZFromScale=n.getZFromScale.bind(Object(m.a)(Object(m.a)(n))),n.changeEmbeddings=n.changeEmbeddings.bind(Object(m.a)(Object(m.a)(n))),n}return Object(h.a)(t,e),Object(l.a)(t,[{key:"zoomScaler",value:function(e,t,n){return _.c().domain([20,0]).range([t,n]).clamp(!0)(e)}},{key:"makeTextSprite",value:function(e,t){void 0===t&&(t={});var n=t.hasOwnProperty("fontface")?t.fontface:"Cambria",a=t.hasOwnProperty("fontsize")?t.fontsize:18,i=t.hasOwnProperty("borderThickness")?t.borderThickness:4,r=t.hasOwnProperty("borderColor")?t.borderColor:{r:0,g:0,b:0,a:1},o=t.hasOwnProperty("backgroundColor")?t.backgroundColor:{r:255,g:0,b:255,a:1},s=t.hasOwnProperty("textColor")?t.textColor:{r:0,g:0,b:0,a:1},l=document.createElement("canvas"),c=l.getContext("2d");c.clearRect(0,0,l.width,l.height),c.font=a+"px "+n;var d=c.measureText(e).width;c.beginPath(),c.rect(0,a/2-5,i+d+10,a+i+10),c.stroke(),c.fillStyle="rgba("+o.r+","+o.g+","+o.b+","+o.a+")",c.strokeStyle="rgba("+r.r+","+r.g+","+r.b+","+r.a+")",c.fill(),c.stroke(),c.fillStyle="rgba("+s.r+", "+s.g+", "+s.b+", 1.0)",c.fillText(e,i,a+i,d);var h=new b.y(l);h.needsUpdate=!0;var u=new b.x({map:h,useScreenCoordinates:!1});return new b.w(u)}},{key:"changeEmbeddings",value:function(e,t){var n=this;console.log(this.props.model_embedding_keys[t]+"img_embeddings");for(var a=[],i=0;i<8;i++){var r=256*i,o=256*(i+1);7===i&&(o=2048),a.push([r,o])}for(var s=a.map(function(e){return n.props[n.props.model_embedding_keys[t]+"img_embeddings"].slice(e[0],e[1])}),l=function(){for(var e=s[c],t=n.scene.children[0].children[c],a=e.length,i=t.geometry.attributes.position.array,r=new Float32Array(3*a),o=0,l=0,d=a;o<d;o++,l+=3){var h=e[o][0],u=e[o][1];r[l]=h,r[l+1]=u,r[l+2]=0}var m=new w.Tween(i).to(i,1e3).easing(w.Easing.Quadratic.InOut);m.onUpdate(function(){t.geometry.attributes.position=new b.a(i,3),t.geometry.attributes.position.needsUpdate=!0}),m.start()},c=0;c<8;c++)l();for(var d=this.props[this.props.model_embedding_keys[t]+"txt_embeddings"],h=this.scene.children[2].children[0],u=d.length,m=h.geometry.vertices,v=new Float32Array(3*u),g=[],f=0,p=0;f<d.length;f++,p+=3){v[p]=d[f][0],v[p+1]=d[f][1],v[p+2]=.5;var y=new b.B(d[f][0],d[f][1],.5);g.push(y)}console.log(m,g);var _=new w.Tween(m).to(g,1e3).easing(w.Easing.Linear.None);_.onUpdate(function(){h.geometry.vertices=g,h.geometry.position.needsUpdate=!0,h.geometry.vertices.needsUpdate=!0}),_.start()}},{key:"getZFromScale",value:function(e){var t=b.j.degToRad(this.camera.fov);return this.props.height/e/(2*Math.tan(t/2))}},{key:"getScaleFromZ",value:function(e){var t=b.j.degToRad(this.camera.fov),n=2*(Math.tan(t/2)*e);return this.props.height/n}},{key:"zoomHandler",value:function(){var e=_.a.transform,t=e.k,n=-(e.x-this.props.width/2)/t,a=(e.y-this.props.height/2)/t,i=this.getZFromScale(t);this.camera.position.set(n,a,i);for(var r=this.zoomScaler(i,this.props.scaleMin,500),o=this.scene.children[0].children,s=0;s<o.length;s++)o[s].material.uniforms.size.value=r}},{key:"setUpCamera",value:function(){var e,t=this.props,n=t.width,a=t.height,i=t.img_embeddings,r=(this.camera.aspect,this.camera.fov),o=b.j.degToRad(r),s=i.map(function(e){return e[0]}),l=y.min(s),c=y.max(s),d=i.map(function(e){return e[1]}),h=y.min(d),u=y.max(d),m=y.max([l,c].map(function(e){return Math.abs(e)})),v=y.max([h,u].map(function(e){return Math.abs(e)})),g=e=(Math.max(m,v)-13)/Math.tan(o/2);this.camera.far=g,this.camera.position.set(0,0,1.1*e),this.d3_zoom=_.e().scaleExtent([this.getScaleFromZ(g-1),this.getScaleFromZ(.1)]).on("zoom",this.zoomHandler.bind(this));var f=_.d(this.mount);this.view=f,f.call(this.d3_zoom);var p=this.getScaleFromZ(this.camera.position.z),w=_.f.translate(n/2,a/2).scale(p);this.d3_zoom.transform(f,w)}},{key:"addPoints",value:function(){for(var e=this.props,t=(e.mnist_embeddings,e.img_embeddings),n=e.mnist_labels,a=(e.img_labels,e.color_array,[]),i=0;i<8;i++){var r=256*i,o=256*(i+1);7===i&&(o=2048),a.push([r,o])}var s=a.map(function(e){return t.slice(e[0],e[1])}),l=a.map(function(e){return n.slice(e[0],e[1])}),c=new b.z;this.textures=k.map(function(e){var t=c.load(e);return t.flipY=!1,t.magFilter=b.m,t});for(var d=new b.f,h=0;h<8;h++){for(var u=s[h],m=(l[h],[]),v=0;v<u.length;v++){var g=u[v],f=new b.B(g[0],g[1],0);m[v]=f}var p=new b.b,y=m.length,_=new Float32Array(3*y),w=new Float32Array(2*y),x=new Float32Array(3*y),j=new Float32Array(y);p.addAttribute("position",new b.a(_,3)),p.addAttribute("offset",new b.a(w,2)),p.addAttribute("filter",new b.a(j,1)),p.addAttribute("cluster",new b.a(x,3));for(var S=0,O=0,E=y;S<E;S++,O+=3){var C=u[S][0],A=u[S][1];_[O]=C,_[O+1]=A,_[O+2]=0}p.translate(-12,-7.5,0);for(var z=0,M=0,F=y;z<F;z++,M+=2){var P=z%16*256/4096,T=256*Math.floor(z/16)/4096;w[M]=P,w[M+1]=T}for(var D=0,I=0,H=y;D<H;D++,I+=1){j[I]=0;2>=[1,2,3,1,2,3].length?(x[3*I]=1,x[3*I+1]=1,x[3*I+2]=1):(x[3*I]=0,x[3*I+1]=1,x[3*I+2]=0)}var U={texture:{value:this.textures[h]},repeat:{value:new b.A(1/16,1/16)},size:{value:this.sprite_image_size},greyTransparency:{value:1},imageTransparency:{value:0},clusterActive:{value:0}},Z=new b.v({uniforms:U,vertexShader:"\n        attribute vec2 offset;\n        varying vec2 vOffset;\n        attribute vec3 cluster;\n        varying vec3 vCluster;\n        attribute float filteredActive;\n        varying float vFilteredActive;\n        uniform float clusterActive;\n        varying float vClusterActive;\n        uniform float size;\n        uniform float greyTransparency;\n        varying float vGreyTransparency;\n        uniform float imageTransparency;\n        varying float vImageTransparency;\n\n        void main() {\n          vOffset = offset;\n          vFilteredActive = filteredActive;\n          vCluster = cluster;\n          vClusterActive = clusterActive;\n          vGreyTransparency = greyTransparency;\n          vImageTransparency = imageTransparency;\n          gl_PointSize = size;\n          gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n        }",fragmentShader:"\n        uniform sampler2D texture;\n        uniform vec2 repeat;\n        varying vec2 vOffset;\n        varying vec3 vCluster;\n        varying float vClusterActive;\n        varying float vFilteredActive;\n        varying float vGreyTransparency;\n        varying float vImageTransparency;\n        void main() {\n          vec2 uv = vec2( gl_PointCoord.x, gl_PointCoord.y );\n          vec4 tex = texture2D( texture, uv * repeat + vOffset );\n          // make transparent images\n          if ( tex.a < 0.003 ) discard;\n\n          // Display clusters\n          vec4 replace_color = vec4(vCluster,1.0);\n          vec4 default_border_color = vec4(0.00392156863,0.00392156863,0.00392156863,0.0);\n          vec4 diff = tex - default_border_color;\n          float equality = float(dot(diff,diff) < 0.99 && vClusterActive > 0.9);\n          tex = mix( tex, replace_color, equality);\n           \n          // make transparent images\n          tex = mix( tex,  vec4(0.0,0.0,0.0,0.0), vImageTransparency);\n\n          // Grey images filter our selection \n          vec4 filterout_color = vec4(0.3,0.3,0.3,vGreyTransparency);\n          float filterout_equality = float(vFilteredActive > 0.9);\n          tex = mix( tex, filterout_color, filterout_equality );\n          gl_FragColor = tex; //* vec4(vColor, 1.0);\n        }",transparent:!0}),B=new b.r(p,Z);B.userData={sprite_index:h},d.add(B)}this.scene.add(d)}},{key:"addTextPoints",value:function(){var e,t,n=this.props,a=n.txt_embeddings,i=(n.mnist_labels,n.img_labels,n.color_array,new b.e),r=[],o=x(a);try{for(o.s();!(t=o.n()).done;){var s=t.value,l=new b.B(s[0]+-12,s[1]+-7.5,.5);l.userData={text:"heyyyy"},i.vertices.push(l);var c=new b.c;c.setHSL(.5,1,.5),r.push(c)}}catch(m){o.e(m)}finally{o.f()}i.colors=r,e=new b.s({size:5,opacity:.9,transparent:!0,sizeAttenuation:!1,vertexColors:b.C});var d=new b.r(i,e);this.pointsContainer=new b.n,this.pointsContainer.add(d),this.scene.add(this.pointsContainer);var h=new b.d(i),u=new b.i(h,new b.h({color:16777215}));this.scene.add(u)}},{key:"addImgPoints",value:function(){var e,t,n=this.props,a=n.img_embeddings,i=(n.mnist_labels,n.img_labels,n.color_array,new b.e),r=[],o=x(a);try{for(o.s();!(t=o.n()).done;){var s=t.value,l=new b.B(s[0],s[1],.5);i.vertices.push(l);var c=new b.c;c.setHSL(.6,1,.5),r.push(c)}}catch(u){o.e(u)}finally{o.f()}i.colors=r,e=new b.s({size:5,sizeAttenuation:!1,vertexColors:b.C});var d=new b.r(i,e),h=new b.n;h.add(d),this.scene.add(h)}},{key:"addTextPointsold",value:function(){var e,t=this,n=this.props;n.mnist_embeddings,n.img_embeddings,n.mnist_labels,n.img_labels,n.color_array;fetch("//fastforwardlabs.github.io/visualization_assets/word2vec_tsne_2d.json").then(function(e){return e.json()}).then(function(n){var a,i=new b.e,r=[],o=x(n);try{for(o.s();!(a=o.n()).done;){var s=a.value,l=new b.B(s.coords[0],s.coords[1],0);i.vertices.push(l);var c=new b.c;c.setHSL(Math.random(),1,.5),r.push(c)}}catch(u){o.e(u)}finally{o.f()}i.colors=r,e=new b.s({size:2,sizeAttenuation:!1,vertexColors:b.C});var d=new b.r(i,e),h=new b.n;h.add(d),t.scene.add(h)})}},{key:"addTextPoints2",value:function(){var e=this.props,t=(e.txt_embeddings,e.mnist_labels,e.txt,e.color_array,new b.z),n=new b.l({map:t.load("https://upload.wikimedia.org/wikipedia/commons/thumb/9/92/Location_dot_red.svg/1200px-Location_dot_red.svg.png")}),a=new b.p(1,1),i=new b.k(a,n);i.position.set(0,0,0),this.scene.add(i);var r=new b.q(16777215,1,0);r.position.set(1,1,100),this.scene.add(r)}},{key:"addtexts",value:function(){for(var e=this.props,t=e.txt,n=e.txt_embeddings,a=0;a<n.length;a++){var i=this.makeTextSprite(t[a],{fontsize:18,textColor:{r:0,g:0,b:0,a:.8}});i.position.set(n[a][0],n[a][1],.5),this.scene.add(i)}}},{key:"addBlankHighlightPoints",value:function(){var e=new b.f;this.scene.add(e);var t=[new b.B(0,0,0)],n=new b.b,a=t.length,i=new Float32Array(3*a),r=new Float32Array(2*a);n.addAttribute("position",new b.a(i,3)),n.addAttribute("offset",new b.a(r,2)),n.translate(-12,-7.5,0);var o={texture:{value:this.textures[0]},repeat:{value:new b.A(1/16,1/16)},size:{value:400}},s=new b.v({uniforms:o,vertexShader:"\n        attribute vec2 offset;\n        varying vec2 vOffset;\n        uniform float size;\n        void main() {\n          vOffset = offset;\n          gl_PointSize = size;\n          gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n        }",fragmentShader:"\n        uniform sampler2D texture;\n        uniform vec2 repeat;\n        varying vec2 vOffset;\n        void main() {\n          vec2 uv = vec2( gl_PointCoord.x, gl_PointCoord.y );\n          vec4 tex = texture2D( texture, uv * repeat + vOffset );\n          gl_FragColor = tex;\n        }",transparent:!0}),l=new b.r(n,s);l.frustumCulled=!1,this.scene.children[1].visible=!1,this.scene.children[1].add(l)}},{key:"highlightPoint",value:function(e,t,n){var a=this.props,i=(a.model_embedding_keys,a.model_choice,a.img_embeddings),r=this.scene.children[1].children[0],o=i[n],s=[new b.B(o[0]+-12,o[1]+-7.5,0)],l=new Float32Array(2),c=t%16*256/4096,d=256*Math.floor(t/16)/4096;l[0]=c,l[1]=d,r.geometry.attributes.position.copyVector3sArray(s),r.geometry.attributes.position.needsUpdate=!0,r.geometry.attributes.offset.array=l,r.geometry.attributes.offset.needsUpdate=!0,r.material.uniforms.texture.value=this.textures[e]}},{key:"removeHighlights",value:function(){var e=this.scene.children[1],t=e.children;e.remove.apply(e,Object(p.a)(t))}},{key:"checkIntersects",value:function(e){var t=this.props,n=t.width,a=t.height,i=t.sidebar_ctx,r=t.sidebar_image_size,o=t.txt,s=t.txt_embeddings;function l(e){return y.sortBy(e,"distanceToRay")}this.getScaleFromZ(this.camera.position.z);var c=function(e){var t=Object(f.a)(e,2),i=t[0],r=t[1];return new b.B(i/n*2-1,-r/a*2+1,1)}(e);this.raycaster.setFromCamera(c,this.camera),this.raycaster.params.Points.threshold=.25;var d=this.raycaster.intersectObjects(this.scene.children[0].children);if(d[0]){console.log("hovered over image");var h=l(d)[0],u=h.object.userData.sprite_index,m=h.index,v=256*u+m;this.props.setHoverIndex(v),this.highlightPoint(u,m,v),this.scene.children[1].visible=!0,i.fillRect(0,0,r,r),i.drawImage(O[u],m%16*256,256*Math.floor(m/16),256,256,0,0,r,r)}else this.props.setHoverIndex(null),this.scene.children[1].visible=!1,i.fillRect(0,0,r,r);var g=this.raycaster.intersectObjects(this.scene.children[2].children);if(g[0]){console.log("hello");var p=l(g)[0];p.object.userData;this.pointsContainer.children[0].geometry.colors[p.index].r=1;var _=this.scene.getObjectByName("tooltip");console.log(this.getScaleFromZ(this.camera.position.z)),this.scene.remove(_);var w=this.makeTextSprite(o[p.index].slice(0,30)+"...",{fontsize:18,textColor:{r:0,g:0,b:0,a:1},borderColor:{r:0,g:0,b:0,a:1},backgroundColor:{r:255,g:255,b:255,a:1}});w.position.set(s[p.index][0]+.5+-12,s[p.index][1]-.5-7.5,.5),w.name="tooltip",w.scale.x=2/this.getScaleFromZ(this.camera.position.z)*120,w.scale.y=1/this.getScaleFromZ(this.camera.position.z)*120,this.scene.add(w),console.log(this.scene.children[0]),document.getElementById("text").innerHTML=o[p.index]}else{_=this.scene.getObjectByName("tooltip");this.props.setHoverIndex(null),this.scene.remove(_)}}},{key:"handleMouse",value:function(){var e=this,t=_.d(this.renderer.domElement);this.raycaster=new b.t,t.on("mousemove",function(){if(!_.a.shiftKey){var n=_.b(t.node()),a=Object(f.a)(n,2),i=[a[0],a[1]];e.checkIntersects(i)}})}},{key:"handlelasso",value:function(){var e=this,t=this.props,n=t.width,a=t.height;t.sidebar_ctx,t.sidebar_image_size;function i(e,t){var i=Object(f.a)(e,2),r=i[0],o=i[1];return new b.B(t*(r/n*2-1.5),-t*(o/a*2-1),1)}function r(e,t){var i=Object(f.a)(e,2),r=i[0],o=i[1];return[t*(r/n*2-1.5),-t*(o/a*2-1)]}this.selectionPoints=[];var o=new b.h({color:255});this.renderer.domElement.addEventListener("pointerdown",function(t){e.lasso=[],e.selectionPoints.length=0,e.points=[],e.points.push(r([t.clientX,t.clientY],e.getScaleFromZ(e.camera.position.z))),e.lasso.push(i([t.clientX,t.clientY],e.getScaleFromZ(e.camera.position.z)))}),this.renderer.domElement.addEventListener("pointerup",function(){console.log(e.points);var t=e.props.img_embeddings;e.checkinside(t,e.points)}),this.renderer.domElement.addEventListener("pointermove",function(t){if(0!==(1&t.buttons)){e.points.push(r([t.clientX,t.clientY],e.getScaleFromZ(e.camera.position.z))),e.lasso.push(i([t.clientX,t.clientY],e.getScaleFromZ(e.camera.position.z)));var n=(new b.b).setFromPoints(e.lasso),a=new b.g(n,o);e.scene.add(a)}})}},{key:"checkinside",value:function(e,t){var n=e.map(function(e){return S(e,t)});console.log(n.reduce(function(e,t){return 1*e+1*t},0))}},{key:"init",value:function(){var e=this.props,t=e.width,n=e.height;this.scene=new b.u,this.scene.background=new b.c("#ffffff");var a=t/n;this.camera=new b.o(15,a,.02,180),this.renderer=new b.D,this.renderer.setClearColor(1118481,1),this.renderer.setSize(t,n),this.mount.appendChild(this.renderer.domElement),this.addPoints(),this.addBlankHighlightPoints(),this.setUpCamera(),this.animate(),this.handleMouse(),this.addTextPoints()}},{key:"animate",value:function(){requestAnimationFrame(this.animate),w.update(),this.renderer.render(this.scene,this.camera)}},{key:"componentDidMount",value:function(){this.init()}},{key:"componentDidUpdate",value:function(e){var t=this.props,n=t.width,a=t.height;n===e.width&&a===e.height||this.handleResize(n,a),e.model_choice!==this.props.model_choice&&this.changeEmbeddings(e.model_choice,this.props.model_choice)}},{key:"componentWillUnmount",value:function(){this.mount.removeChild(this.renderer.domElement)}},{key:"render",value:function(){var e=this,t=this.props,n=t.width,a=t.height;return i.a.createElement("div",{style:{width:n,height:a,overflow:"hidden"},ref:function(t){e.mount=t}})}}]),t}(a.Component),C=n(45),A=n.n(C),z=function(e){function t(){return Object(s.a)(this,t),Object(c.a)(this,Object(d.a)(t).apply(this,arguments))}return Object(h.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){var e=this,t=this.props,n=t.grem;t.p;return i.a.createElement("div",{style:{position:"fixed",left:0,top:0,right:0,bottom:0,background:"#222",color:"#fff",paddingTop:2*n,overflowY:"auto",fontSize:16,lineHeight:1.5}},i.a.createElement("div",{style:{background:"#333",position:"fixed",left:0,top:0,right:0,padding:n/2}},"About",i.a.createElement("button",{onClick:function(){e.props.toggleAbout(!1)},className:"hover-555",style:{position:"absolute",right:0,top:0,height:2*n,width:2*n,padding:n/2,textAlign:"center",cursor:"pointer",textDecoration:"none"}},"\xd7")),i.a.createElement("div",{style:{maxWidth:30*n,margin:"0 auto",padding:n/2,color:"#fff"}},i.a.createElement(A.a,null,"\n# About EmbedAnything\nThis is an interactive visualization that embeds, clusters and analyses multimodal data.")))}}]),t}(a.Component);function M(e,t){return"".concat(e,"px ").concat(t,"px")}var F=[[141,211,199],[255,255,179],[190,186,218],[251,128,114],[128,177,211],[253,180,98],[179,222,105],[252,205,229],[188,128,189],[141,211,199],[255,255,179],[190,186,218],[251,128,114],[128,177,211],[253,180,98],[179,222,105],[252,205,229],[188,128,189],[141,211,199],[255,255,179],[190,186,218],[251,128,114],[128,177,211],[253,180,98],[179,222,105],[252,205,229],[188,128,189],[141,211,199],[255,255,179],[190,186,218],[251,128,114],[128,177,211],[253,180,98],[179,222,105],[252,205,229],[188,128,189],[141,211,199],[255,255,179],[190,186,218],[251,128,114],[128,177,211],[253,180,98],[179,222,105],[252,205,229],[188,128,189],[141,211,199],[255,255,179],[190,186,218],[251,128,114],[128,177,211],[253,180,98],[179,222,105],[252,205,229],[188,128,189],[141,211,199],[255,255,179],[190,186,218],[251,128,114],[128,177,211],[253,180,98],[179,222,105],[252,205,229],[188,128,189]],P=function(e){function t(e){var n;return Object(s.a)(this,t),(n=Object(c.a)(this,Object(d.a)(t).call(this,e))).state={ww:null,wh:null,sidebar_height:null,hover_index:null,show_about:null,algorithm_choice:0,model_choice:0,dataset_choice:0,scaleMin:60},n.sidebar_ctx=null,n.setSize=y.debounce(n.setSize.bind(Object(m.a)(Object(m.a)(n))),200),n.checkHash=n.checkHash.bind(Object(m.a)(Object(m.a)(n))),n.setSidebarCanvas=n.setSidebarCanvas.bind(Object(m.a)(Object(m.a)(n))),n.toggleAbout=n.toggleAbout.bind(Object(m.a)(Object(m.a)(n))),n.selectAlgorithm=n.selectAlgorithm.bind(Object(m.a)(Object(m.a)(n))),n.selectModel=n.selectModel.bind(Object(m.a)(Object(m.a)(n))),n.selectDataset=n.selectDataset.bind(Object(m.a)(Object(m.a)(n))),n.selectScaleMin=n.selectScaleMin.bind(Object(m.a)(Object(m.a)(n))),n}return Object(h.a)(t,e),Object(l.a)(t,[{key:"selectAlgorithm",value:function(e){var t=this.props.algorithm_options.indexOf(e);this.setState({algorithm_choice:t})}},{key:"selectModel",value:function(e){var t=this.props.model_options.indexOf(e);this.setState({model_choice:t})}},{key:"selectDataset",value:function(e){var t=this.props.dataset_options.indexOf(e);console.log(this.props.dataset_options),this.setState({dataset_choice:t})}},{key:"selectScaleMin",value:function(e){console.log(e),this.setState({scaleMin:e})}},{key:"setSize",value:function(){this.setState({ww:window.innerWidth,wh:window.innerHeight});var e=this.sidebar_mount.offsetHeight;this.setState({sidebar_height:e}),this.sidebar_ctx&&(this.sidebar_ctx.imageSmoothingEnabled=!1)}},{key:"setSidebarCanvas",value:function(e){var t=e.getContext("2d");t.imageSmoothingEnabled=!1,this.sidebar_ctx=t}},{key:"toggleAbout",value:function(e){!0===e?(window.history.pushState(null,"About UMAP Explorer","#about"),this.setState({show_about:!0})):!1===e&&(window.history.pushState(null,"UMAP Explorer",window.location.pathname),this.setState({show_about:!1}))}},{key:"setHoverIndex",value:function(e){this.setState({hover_index:e})}},{key:"componentWillMount",value:function(){this.setSize(),this.checkHash()}},{key:"checkHash",value:function(){window.location.hash&&"#about"===window.location.hash?this.setState({show_about:!0}):this.setState({show_about:!1})}},{key:"componentDidMount",value:function(){window.addEventListener("resize",this.setSize),window.addEventListener("popstate",this.checkHash)}},{key:"componentWillUnmount",value:function(){window.removeEventListener("resize",this.setSize)}},{key:"handleChangeScale",value:function(e,t){this.setState({scaleMin:t}),console.log(t)}},{key:"render",value:function(){var e,t,n=this,a=this.props,r=a.mnist_embeddings,o=a.txt,s=a.txt_embeddings,l=a.img_embeddings,c=a.clip_img_embeddings,d=a.clip_txt_embeddings,h=a.mnist_labels,m=a.algorithm_options,v=a.model_options,f=a.dataset_options,p=a.algorithm_embedding_keys,b=a.model_embedding_keys,y=a.img_labels,_=a.scaleMax,w=this.state,x=w.ww,j=w.wh,S=w.sidebar_height,k=w.hover_index,O=w.show_about,C=w.model_choice,A=w.algorithm_choice,P=w.dataset_choice,T=w.scaleMin,D=this.sidebar_ctx,I={position:"absolute",left:0,top:0,height:"100vh",overflow:"auto",background:"#222",display:"flex",flexDirection:"column"},H={position:"relative",height:"100vh",background:"#111",overflow:"hidden"},U=16;if(x<800)U=14,I=Object(u.a)({},I,{flexDirection:"row",width:"100%",top:"auto",height:"auto",bottom:0}),H={width:x,height:j-S},e=1.5*U*3,t="horizontal";else if(x<1400){var Z=200+(x-800)/600*100;U=14+(x-800)/600*2,e=(I=Object(u.a)({},I,{width:Z})).width,H=Object(u.a)({},H,{width:x-Z,left:Z,height:j}),t="vertical"}else I=Object(u.a)({},I,{width:300}),H=Object(u.a)({},H,{width:x-300,left:300,height:j}),e=I.width,t="vertical";var B=1.5*U,L={fontSize:U,lineHeight:1.5};return null!==x?i.a.createElement("div",{style:L},i.a.createElement("div",{style:I,ref:function(e){n.sidebar_mount=e}},i.a.createElement(g,{sidebar_orientation:t,sidebar_image_size:e,grem:B,p:M,color_array:F,setSidebarCanvas:this.setSidebarCanvas,hover_index:k,mnist_labels:h,txt:o,toggleAbout:this.toggleAbout,algorithm_options:m,algorithm_choice:A,selectAlgorithm:this.selectAlgorithm,model_options:v,model_choice:C,selectModel:this.selectModel,dataset_options:f,dataset_choice:P,selectDataset:this.selectDataset,selectScaleMin:this.selectScaleMin,img_labels:y,scaleMin:T,scaleMax:_,handleChangeScale:this.handleChangeScale})),i.a.createElement("div",{style:H},i.a.createElement(E,{width:H.width,height:H.height,mnist_embeddings:r,txt:o,txt_embeddings:s,img_embeddings:l,clip_img_embeddings:c,clip_txt_embeddings:d,mnist_labels:h,color_array:F,sidebar_ctx:D,sidebar_image_size:e,setHoverIndex:this.setHoverIndex.bind(this),algorithm_embedding_keys:p,algorithm_choice:A,model_embedding_keys:b,model_choice:C,scaleMin:T,scaleMax:500})),O?i.a.createElement(z,{grem:B,p:M,toggleAbout:this.toggleAbout}):null):i.a.createElement("div",{style:{padding:"1rem"}},"Loading projections...")}}]),t}(a.Component),T=["UMAP"],D=["mnist_embeddings"],I=["fairface_"],H=["","clip_"],U=["ib_"],Z=function(e){function t(e){var n;return Object(s.a)(this,t),(n=Object(c.a)(this,Object(d.a)(t).call(this,e))).state={mnist_embeddings:null,mnist_labels:null,md08_umap_mnist_embeddings:null,txt_embeddings:null},n}return Object(h.a)(t,e),Object(l.a)(t,[{key:"scaleEmbeddings",value:function(e){var t=e.map(function(e){return Math.abs(e[0])}),n=e.map(function(e){return Math.abs(e[1])}),a=y.max(t),i=y.max(n),r=Math.max(a,i),o=_.c().domain([-r,r]).range([-20,20]);return e.map(function(e){return[o(e[0]),o(e[1])]})}},{key:"componentDidMount",value:function(){var e=this;fetch("".concat("/EmbedAnything","/mnist_embeddings.json")).then(function(e){return e.json()}).then(function(t){var n=e.scaleEmbeddings(t);e.setState({mnist_embeddings:n})}),fetch("".concat("/EmbedAnything","/mnist_labels.json")).then(function(e){return e.json()}).then(function(t){return e.setState({mnist_labels:t})}),fetch("".concat("/EmbedAnything","/data/")+"fairface_ib_txt_embeddings.json").then(function(e){return e.json()}).then(function(t){var n=e.scaleEmbeddings(t);e.setState({txt_embeddings:n})}),fetch("".concat("/EmbedAnything","/data/")+"fairface_ib_img_embeddings.json").then(function(e){return e.json()}).then(function(t){console.log(t);var n=e.scaleEmbeddings(t);e.setState({img_embeddings:n})}),fetch("".concat("/EmbedAnything","/data/")+"fairface_txt.json").then(function(e){return e.json()}).then(function(t){e.setState({txt:t})}),fetch("".concat("/EmbedAnything","/data/")+"fairface_img_labels.json").then(function(e){return e.json()}).then(function(t){e.setState({img_labels:t})})}},{key:"render",value:function(){return this.state.mnist_embeddings&&this.state.mnist_labels?i.a.createElement(P,Object.assign({},this.state,{algorithm_options:T,model_options:I,dataset_options:U,algorithm_embedding_keys:D,model_embedding_keys:H})):i.a.createElement("div",{style:{padding:"1rem"}},"Loading data...")}}]),t}(a.Component),B=function(e){function t(){return Object(s.a)(this,t),Object(c.a)(this,Object(d.a)(t).apply(this,arguments))}return Object(h.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){return i.a.createElement(Z,null)}}]),t}(a.Component);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));o.a.render(i.a.createElement(B,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})},62:function(e,t,n){e.exports=n(133)},69:function(e,t,n){},71:function(e,t,n){}},[[62,2,1]]]);
//# sourceMappingURL=main.9d73acdf.chunk.js.map